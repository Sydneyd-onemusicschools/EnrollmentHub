<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Portal - Enrollment Hub</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --color-coral: #F97B5F;
      --color-coral-dark: #E86A4F;
      --color-salmon: #F472B6;
      --gradient-coral: linear-gradient(135deg, #F97B5F 0%, #FDAB8E 100%);
      --gradient-salmon: linear-gradient(135deg, #F472B6 0%, #F9A8D4 100%);
      --gradient-hero: linear-gradient(135deg, #F97B5F 0%, #F472B6 100%);
      --color-bg: #F9FAFB;
      --color-white: #FFFFFF;
      --color-text: #1F2937;
      --color-text-muted: #6B7280;
      --color-text-light: #9CA3AF;
      --color-border: #E5E7EB;
      --color-success: #10B981;
      --color-warning: #F59E0B;
      --color-danger: #EF4444;
      --color-info: #3B82F6;
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --sidebar-width: 250px;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--color-bg);
      color: var(--color-text);
      min-height: 100vh;
      line-height: 1.5;
    }

    .app-layout { display: flex; min-height: 100vh; }

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--color-white);
      border-right: 1px solid var(--color-border);
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid var(--color-border);
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .sidebar-logo-icon {
      width: 40px;
      height: 40px;
      background: var(--gradient-hero);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 800;
      font-size: 14px;
    }

    .sidebar-logo-text h1 {
      font-size: 15px;
      font-weight: 700;
    }

    .sidebar-logo-text p {
      font-size: 12px;
      color: var(--color-text-muted);
    }

    .sidebar-nav {
      flex: 1;
      padding: 16px 12px;
      overflow-y: auto;
    }

    .nav-section { margin-bottom: 24px; }

    .nav-section-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--color-text-light);
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: var(--radius-sm);
      color: var(--color-text-muted);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
      margin-bottom: 2px;
    }

    .nav-item:hover {
      background: var(--color-bg);
      color: var(--color-text);
    }

    .nav-item.active {
      background: linear-gradient(135deg, rgba(249, 123, 95, 0.1) 0%, rgba(244, 114, 182, 0.1) 100%);
      color: var(--color-coral);
    }

    .nav-item svg { width: 18px; height: 18px; flex-shrink: 0; }

    .sidebar-footer {
      padding: 16px 20px;
      border-top: 1px solid var(--color-border);
      font-size: 11px;
      color: var(--color-text-light);
    }

    /* Mobile */
    .mobile-header {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: var(--color-white);
      border-bottom: 1px solid var(--color-border);
      padding: 0 16px;
      align-items: center;
      justify-content: space-between;
      z-index: 99;
    }

    .mobile-menu-btn {
      width: 40px;
      height: 40px;
      border: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text);
      border-radius: var(--radius-sm);
    }

    .sidebar-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      z-index: 99;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      padding: 28px;
      min-height: 100vh;
    }

    .page-header { margin-bottom: 24px; }

    .page-header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      flex-wrap: wrap;
    }

    .page-header h1 {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .page-header p {
      font-size: 14px;
      color: var(--color-text-muted);
    }

    /* Sections */
    .section { display: none; }
    .section.active { display: block; animation: fadeIn 0.2s ease; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Card */
    .card {
      background: var(--color-white);
      border-radius: var(--radius-lg);
      border: 1px solid var(--color-border);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 18px;
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.15s ease;
      font-family: inherit;
    }

    .btn svg { width: 16px; height: 16px; }

    .btn-primary {
      background: var(--gradient-hero);
      color: white;
    }

    .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }

    .btn-secondary {
      background: var(--color-white);
      border: 1px solid var(--color-border);
      color: var(--color-text);
    }

    .btn-secondary:hover { background: var(--color-bg); }

    .btn-danger { background: var(--color-danger); color: white; }

    /* Tables */
    .data-table { width: 100%; border-collapse: collapse; }

    .data-table th,
    .data-table td {
      padding: 14px 20px;
      text-align: left;
      border-bottom: 1px solid var(--color-border);
    }

    .data-table th {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--color-text-muted);
      background: var(--color-bg);
    }

    .data-table td { font-size: 14px; }
    .data-table tr:last-child td { border-bottom: none; }
    .data-table tr:hover td { background: rgba(249, 123, 95, 0.02); }

    .table-actions { display: flex; gap: 8px; justify-content: flex-end; }

    .action-btn {
      width: 34px;
      height: 34px;
      border: none;
      background: var(--color-bg);
      cursor: pointer;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-muted);
      transition: all 0.15s ease;
    }

    .action-btn:hover {
      background: linear-gradient(135deg, rgba(249, 123, 95, 0.1) 0%, rgba(244, 114, 182, 0.1) 100%);
      color: var(--color-coral);
    }

    .action-btn.delete:hover {
      background: rgba(239, 68, 68, 0.1);
      color: var(--color-danger);
    }

    .action-btn svg { width: 16px; height: 16px; }

    /* Badges */
    .badge {
      display: inline-flex;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .badge-success { background: rgba(16, 185, 129, 0.1); color: var(--color-success); }
    .badge-warning { background: rgba(245, 158, 11, 0.1); color: var(--color-warning); }
    .badge-muted { background: var(--color-bg); color: var(--color-text-muted); }
    .badge-info { background: rgba(59, 130, 246, 0.1); color: var(--color-info); }

    /* Forms */
    .form-group { margin-bottom: 18px; }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 6px;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-family: inherit;
      color: var(--color-text);
      background: var(--color-white);
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--color-coral);
      box-shadow: 0 0 0 3px rgba(249, 123, 95, 0.1);
    }

    .form-textarea { min-height: 100px; resize: vertical; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .form-hint { font-size: 12px; color: var(--color-text-light); margin-top: 4px; }

    /* Editor */
    .editor-container {
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      overflow: hidden;
    }

    .editor-toolbar {
      display: flex;
      gap: 4px;
      padding: 10px 12px;
      background: var(--color-bg);
      border-bottom: 1px solid var(--color-border);
      flex-wrap: wrap;
    }

    .editor-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: var(--color-white);
      border-radius: var(--radius-sm);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-muted);
      font-size: 14px;
      font-weight: 600;
      transition: all 0.15s ease;
    }

    .editor-btn:hover { background: var(--gradient-hero); color: white; }
    .editor-btn svg { width: 16px; height: 16px; }

    .editor-content {
      min-height: 200px;
      padding: 16px;
      font-size: 14px;
      line-height: 1.7;
      outline: none;
    }

    .editor-content:focus { background: rgba(249, 123, 95, 0.02); }
    .editor-content h2 { font-size: 18px; font-weight: 600; margin: 20px 0 10px; color: var(--color-coral); }
    .editor-content h2:first-child { margin-top: 0; }
    .editor-content h3 { font-size: 15px; font-weight: 600; margin: 16px 0 8px; }
    .editor-content p { margin-bottom: 12px; }
    .editor-content ul, .editor-content ol { margin: 12px 0; padding-left: 24px; }
    .editor-content li { margin-bottom: 6px; }

    /* Modals */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.6);
      z-index: 200;
      align-items: center;
      justify-content: center;
      padding: 20px;
      backdrop-filter: blur(4px);
    }

    .modal-overlay.active { display: flex; }

    .modal {
      background: var(--color-white);
      border-radius: var(--radius-lg);
      width: 100%;
      max-width: 540px;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: var(--shadow-lg);
      animation: modalIn 0.2s ease;
    }

    @keyframes modalIn {
      from { opacity: 0; transform: scale(0.95) translateY(10px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 24px;
      border-bottom: 1px solid var(--color-border);
    }

    .modal-header h2 { font-size: 17px; font-weight: 600; }

    .modal-close {
      width: 34px;
      height: 34px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-muted);
      transition: all 0.15s ease;
    }

    .modal-close:hover { background: var(--color-bg); color: var(--color-text); }

    .modal-body {
      padding: 24px;
      overflow-y: auto;
      max-height: calc(90vh - 130px);
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      padding: 16px 24px;
      border-top: 1px solid var(--color-border);
      background: var(--color-bg);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--color-text-muted);
    }

    .empty-state-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, rgba(249, 123, 95, 0.1) 0%, rgba(244, 114, 182, 0.1) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      color: var(--color-coral);
    }

    .empty-state-icon svg { width: 26px; height: 26px; }
    .empty-state h3 { font-size: 16px; font-weight: 600; color: var(--color-text); margin-bottom: 6px; }
    .empty-state p { font-size: 14px; margin-bottom: 20px; }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--color-text);
      color: white;
      padding: 14px 20px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 500;
      box-shadow: var(--shadow-lg);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 300;
    }

    .toast.show { transform: translateY(0); opacity: 1; }
    .toast.success { background: var(--color-success); }
    .toast.error { background: var(--color-danger); }

    /* Tabs */
    .tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }

    .tab-btn {
      padding: 8px 16px;
      border: 1px solid var(--color-border);
      background: var(--color-white);
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-weight: 500;
      color: var(--color-text-muted);
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .tab-btn:hover { border-color: var(--color-coral); color: var(--color-coral); }
    .tab-btn.active { background: var(--gradient-hero); color: white; border-color: transparent; }

    /* Team Grid */
    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }

    .team-card {
      background: var(--color-white);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: 20px;
      transition: all 0.15s ease;
      position: relative;
      overflow: hidden;
    }

    .team-card:hover { border-color: var(--color-coral); box-shadow: var(--shadow-md); }

    .team-card-featured {
      border: 2px solid var(--featured-color, var(--color-coral));
      background: linear-gradient(135deg, rgba(249, 123, 95, 0.03) 0%, rgba(244, 114, 182, 0.03) 100%);
    }

    .team-card-featured:hover {
      box-shadow: 0 8px 30px rgba(249, 123, 95, 0.15);
      transform: translateY(-2px);
    }

    .featured-banner {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: var(--color-coral);
      color: white;
      font-size: 11px;
      font-weight: 600;
      text-align: center;
      padding: 4px 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .team-card-header { display: flex; align-items: center; gap: 14px; margin-bottom: 14px; }

    .team-avatar {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      object-fit: cover;
      background: var(--color-bg);
      flex-shrink: 0;
    }

    .team-info { min-width: 0; flex: 1; }
    .team-info h4 { font-size: 15px; font-weight: 600; margin-bottom: 4px; }
    .team-info .zone { font-size: 12px; color: var(--color-text-muted); margin-top: 4px; }

    .team-details {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding-top: 14px;
      border-top: 1px solid var(--color-border);
    }

    .team-detail {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: var(--color-text-muted);
      min-width: 0;
    }

    .team-detail svg { width: 14px; height: 14px; color: var(--color-text-light); flex-shrink: 0; }

    .team-detail a {
      color: var(--color-coral);
      text-decoration: none;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .team-detail a:hover { text-decoration: underline; }

    .team-card-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid var(--color-border);
    }

    /* Photo Upload */
    .photo-upload { display: flex; align-items: center; gap: 16px; }

    .photo-preview {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      object-fit: cover;
      background: var(--color-bg);
      border: 2px solid var(--color-border);
    }

    .photo-upload-btn { flex: 1; }
    .photo-upload-btn input[type="file"] { display: none; }

    .photo-upload-btn label {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      font-size: 13px;
      color: var(--color-text-muted);
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .photo-upload-btn label:hover {
      background: var(--color-white);
      border-color: var(--color-coral);
      color: var(--color-coral);
    }

    /* Workflow Image Upload */
    .workflow-image-upload {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .workflow-image-preview {
      background: var(--color-bg);
      border: 2px dashed var(--color-border);
      border-radius: var(--radius-md);
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .workflow-image-placeholder {
      text-align: center;
      color: var(--color-text-light);
      padding: 40px;
    }

    .workflow-image-placeholder svg {
      margin-bottom: 12px;
      opacity: 0.5;
    }

    .workflow-image-placeholder p {
      font-size: 14px;
    }

    .workflow-image-actions {
      display: flex;
      gap: 12px;
    }

    /* Category Pills */
    .category-pills { display: flex; flex-wrap: wrap; gap: 8px; }

    .category-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: 20px;
      font-size: 13px;
      color: var(--color-text-muted);
    }

    .category-pill .delete-cat {
      width: 18px;
      height: 18px;
      border: none;
      background: transparent;
      cursor: pointer;
      color: var(--color-text-light);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .category-pill .delete-cat:hover { background: var(--color-danger); color: white; }
    .category-pill .delete-cat svg { width: 12px; height: 12px; }

    /* Checkbox */
    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      font-size: 14px;
    }

    .checkbox-label input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--color-coral);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar { transform: translateX(-100%); }
      .sidebar.open { transform: translateX(0); }
      .sidebar-overlay.open { display: block; }
      .mobile-header { display: flex; }
      .main-content { margin-left: 0; padding: 76px 16px 24px; }
      .page-header h1 { font-size: 20px; }
      .form-row { grid-template-columns: 1fr; }
      .team-grid { grid-template-columns: 1fr; }
      .modal { max-width: 100%; margin: 10px; }
    }
  </style>
</head>
<body>
  <div class="app-layout">
    <!-- Mobile Header -->
    <div class="mobile-header">
      <button class="mobile-menu-btn" onclick="toggleSidebar()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
      <span style="font-weight: 600;">Enrollment Hub</span>
      <div style="width: 40px;"></div>
    </div>
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="sidebar-logo-icon">EH</div>
          <div class="sidebar-logo-text">
            <h1>Enrollment Hub</h1>
            <p>Admin Portal</p>
          </div>
        </div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Content</div>
          <div class="nav-item active" onclick="switchSection('announcements', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 4H5a2 2 0 00-2 2v14l4-4h12a2 2 0 002-2V6a2 2 0 00-2-2z"></path></svg>
            Announcements
          </div>
          <div class="nav-item" onclick="switchSection('promotions', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg>
            Promotions
          </div>
          <div class="nav-item" onclick="switchSection('responsibilities', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path></svg>
            Responsibilities
          </div>
          <div class="nav-item" onclick="switchSection('script', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.83 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
            Enrollment Script
          </div>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Enrollment Team</div>
          <div class="nav-item" onclick="switchSection('team', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 00-3-3.87"></path><path d="M16 3.13a4 4 0 010 7.75"></path></svg>
            Team Members
          </div>
          <div class="nav-item" onclick="switchSection('whatwedo', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path></svg>
            What We Do
          </div>
          <div class="nav-item" onclick="switchSection('workflow', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
            Our Workflow
          </div>
          <div class="nav-item" onclick="switchSection('roles', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"></path></svg>
            Manage Roles
          </div>
        </div>
      </nav>

      <div class="sidebar-footer">
        <p>Enrollment Hub Admin v1.0</p>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Announcements -->
      <section id="announcements" class="section active">
        <div class="page-header">
          <div class="page-header-row">
            <div>
              <h1>Announcements</h1>
              <p>Manage news and updates for directors</p>
            </div>
            <button class="btn btn-primary" onclick="openModal('announcement')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
              Add Announcement
            </button>
          </div>
        </div>
        <div class="card">
          <table class="data-table">
            <thead><tr><th>Title</th><th>Date</th><th>Status</th><th style="width:100px;text-align:right;">Actions</th></tr></thead>
            <tbody id="announcementsList"></tbody>
          </table>
        </div>
      </section>

      <!-- Promotions -->
      <section id="promotions" class="section">
        <div class="page-header">
          <div class="page-header-row">
            <div>
              <h1>Promotions</h1>
              <p>Manage promos and discounts</p>
            </div>
            <button class="btn btn-primary" onclick="openModal('promotion')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
              Add Promotion
            </button>
          </div>
        </div>
        <div class="tabs">
          <button class="tab-btn active" onclick="switchPromoTab('active', this)">Active</button>
          <button class="tab-btn" onclick="switchPromoTab('upcoming', this)">Upcoming</button>
          <button class="tab-btn" onclick="switchPromoTab('expired', this)">Expired</button>
        </div>
        <div class="card">
          <table class="data-table">
            <thead><tr><th>Title</th><th>Type</th><th>Discount</th><th>Dates</th><th style="width:100px;text-align:right;">Actions</th></tr></thead>
            <tbody id="promotionsList"></tbody>
          </table>
        </div>
      </section>

      <!-- What We Do -->
      <section id="whatwedo" class="section">
        <div class="page-header">
          <div class="page-header-row">
            <div>
              <h1>What We Do</h1>
              <p>Describe what the enrollment team does</p>
            </div>
            <button class="btn btn-primary" onclick="saveWhatWeDo()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
              Save
            </button>
          </div>
        </div>
        <div class="card">
          <div class="editor-container">
            <div class="editor-toolbar">
              <button class="editor-btn" onclick="formatDoc('bold')"><strong>B</strong></button>
              <button class="editor-btn" onclick="formatDoc('italic')"><em>I</em></button>
              <button class="editor-btn" onclick="formatDoc('underline')"><u>U</u></button>
              <button class="editor-btn" onclick="formatBlock('h2')">H2</button>
              <button class="editor-btn" onclick="formatBlock('h3')">H3</button>
              <button class="editor-btn" onclick="formatDoc('insertUnorderedList')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
              </button>
              <button class="editor-btn" onclick="formatDoc('insertOrderedList')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="10" y1="6" x2="21" y2="6"></line><line x1="10" y1="12" x2="21" y2="12"></line><line x1="10" y1="18" x2="21" y2="18"></line><text x="3" y="7" font-size="8" fill="currentColor">1</text><text x="3" y="13" font-size="8" fill="currentColor">2</text><text x="3" y="19" font-size="8" fill="currentColor">3</text></svg>
              </button>
            </div>
            <div class="editor-content" id="whatWeDoEditor" contenteditable="true"></div>
          </div>
        </div>
      </section>

      <!-- Our Workflow -->
      <section id="workflow" class="section">
        <div class="page-header">
          <div class="page-header-row">
            <div>
              <h1>Our Workflow</h1>
              <p>Upload a workflow diagram and add notes</p>
            </div>
            <button class="btn btn-primary" onclick="saveWorkflow()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
              Save
            </button>
          </div>
        </div>
        
        <!-- Workflow Image Upload -->
        <div class="card" style="margin-bottom: 20px;">
          <div style="padding: 24px;">
            <label class="form-label">Workflow Diagram</label>
            <p style="font-size: 13px; color: var(--color-text-muted); margin-bottom: 16px;">Upload an image of your workflow process (PNG, JPG, or GIF)</p>
            
            <div class="workflow-image-upload">
              <div class="workflow-image-preview" id="workflowImagePreview">
                <div class="workflow-image-placeholder" id="workflowImagePlaceholder">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="48" height="48">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                  </svg>
                  <p>No workflow image uploaded</p>
                </div>
                <img id="workflowImageImg" src="" alt="Workflow diagram" style="display: none; max-width: 100%; border-radius: 8px;">
              </div>
              <div class="workflow-image-actions">
                <input type="file" id="workflowImageFile" accept="image/*" onchange="previewWorkflowImage(this)" style="display: none;">
                <label for="workflowImageFile" class="btn btn-secondary">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                  Upload Image
                </label>
                <button class="btn btn-secondary" onclick="removeWorkflowImage()" id="removeWorkflowImageBtn" style="display: none;">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path></svg>
                  Remove
                </button>
                <input type="hidden" id="workflowImageUrl">
              </div>
            </div>
          </div>
        </div>

        <!-- Workflow Notes -->
        <div class="card">
          <div style="padding: 24px;">
            <label class="form-label">Additional Notes</label>
            <p style="font-size: 13px; color: var(--color-text-muted); margin-bottom: 16px;">Add any extra instructions or details about the workflow</p>
            <div class="editor-container">
              <div class="editor-toolbar">
                <button class="editor-btn" onclick="formatDoc('bold')"><strong>B</strong></button>
                <button class="editor-btn" onclick="formatDoc('italic')"><em>I</em></button>
                <button class="editor-btn" onclick="formatDoc('underline')"><u>U</u></button>
                <button class="editor-btn" onclick="formatBlock('h2')">H2</button>
                <button class="editor-btn" onclick="formatBlock('h3')">H3</button>
                <button class="editor-btn" onclick="formatDoc('insertUnorderedList')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                </button>
                <button class="editor-btn" onclick="formatDoc('insertOrderedList')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="10" y1="6" x2="21" y2="6"></line><line x1="10" y1="12" x2="21" y2="12"></line><line x1="10" y1="18" x2="21" y2="18"></line><text x="3" y="7" font-size="8" fill="currentColor">1</text><text x="3" y="13" font-size="8" fill="currentColor">2</text><text x="3" y="19" font-size="8" fill="currentColor">3</text></svg>
                </button>
              </div>
              <div class="editor-content" id="workflowEditor" contenteditable="true"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Script -->
      <section id="script" class="section">
        <div class="page-header">
          <div class="page-header-row">
            <div>
              <h1>Enrollment Script</h1>
              <p>Edit the enrollment conversation guide</p>
            </div>
            <button class="btn btn-primary" onclick="saveScript()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
              Save Script
            </button>
          </div>
        </div>
        <div class="card">
          <div class="editor-container">
            <div class="editor-toolbar">
              <button class="editor-btn" onclick="formatDoc('bold')"><strong>B</strong></button>
              <button class="editor-btn" onclick="formatDoc('italic')"><em>I</em></button>
              <button class="editor-btn" onclick="formatDoc('underline')"><u>U</u></button>
              <button class="editor-btn" onclick="formatBlock('h2')">H2</button>
              <button class="editor-btn" onclick="formatBlock('h3')">H3</button>
              <button class="editor-btn" onclick="formatDoc('insertUnorderedList')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
              </button>
              <button class="editor-btn" onclick="formatDoc('insertOrderedList')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="10" y1="6" x2="21" y2="6"></line><line x1="10" y1="12" x2="21" y2="12"></line><line x1="10" y1="18" x2="21" y2="18"></line><text x="3" y="7" font-size="8" fill="currentColor">1</text><text x="3" y="13" font-size="8" fill="currentColor">2</text><text x="3" y="19" font-size="8" fill="currentColor">3</text></svg>
              </button>
            </div>
            <div class="editor-content" id="scriptEditor" contenteditable="true"></div>
          </div>
        </div>
      </section>

      <!-- Team -->
      <section id="team" class="section">
        <div class="page-header">
          <div class="page-header-row">
            <div>
              <h1>Team Members</h1>
              <p>Manage your enrollment team directory</p>
            </div>
            <button class="btn btn-primary" onclick="openModal('team')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
              Add Team Member
            </button>
          </div>
        </div>
        <div class="team-grid" id="teamGrid"></div>
      </section>

      <!-- Roles -->
      <section id="roles" class="section">
        <div class="page-header">
          <div class="page-header-row">
            <div>
              <h1>Manage Roles</h1>
              <p>Define team roles with custom colors</p>
            </div>
            <button class="btn btn-primary" onclick="openModal('role')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
              Add Role
            </button>
          </div>
        </div>
        <div class="card">
          <table class="data-table">
            <thead><tr><th>Role Name</th><th>Color</th><th>Featured</th><th style="width:100px;text-align:right;">Actions</th></tr></thead>
            <tbody id="rolesList"></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <!-- Announcement Modal -->
  <div class="modal-overlay" id="announcementModal" onclick="closeModalOnOverlay(event, 'announcement')">
    <div class="modal">
      <div class="modal-header">
        <h2 id="announcementModalTitle">Add Announcement</h2>
        <button class="modal-close" onclick="closeModal('announcement')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="announcementId">
        <div class="form-group">
          <label class="form-label">Title *</label>
          <input type="text" class="form-input" id="announcementTitle" placeholder="Enter title">
        </div>
        <div class="form-group">
          <label class="form-label">Content</label>
          <div class="editor-container">
            <div class="editor-toolbar">
              <button class="editor-btn" onclick="formatDocIn('announcementContent', 'bold')"><strong>B</strong></button>
              <button class="editor-btn" onclick="formatDocIn('announcementContent', 'italic')"><em>I</em></button>
              <button class="editor-btn" onclick="formatDocIn('announcementContent', 'insertUnorderedList')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg></button>
            </div>
            <div class="editor-content" id="announcementContent" contenteditable="true" style="min-height:100px;"></div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" id="announcementDate">
          </div>
          <div class="form-group">
            <label class="form-label">&nbsp;</label>
            <label class="checkbox-label"><input type="checkbox" id="announcementActive" checked> Active</label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('announcement')">Cancel</button>
        <button class="btn btn-primary" onclick="saveAnnouncement()">Save</button>
      </div>
    </div>
  </div>

  <!-- Promotion Modal -->
  <div class="modal-overlay" id="promotionModal" onclick="closeModalOnOverlay(event, 'promotion')">
    <div class="modal">
      <div class="modal-header">
        <h2 id="promotionModalTitle">Add Promotion</h2>
        <button class="modal-close" onclick="closeModal('promotion')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="promotionId">
        <div class="form-group">
          <label class="form-label">Title *</label>
          <input type="text" class="form-input" id="promotionTitle" placeholder="Enter title">
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <div class="editor-container">
            <div class="editor-toolbar">
              <button class="editor-btn" onclick="formatDocIn('promotionDescription', 'bold')"><strong>B</strong></button>
              <button class="editor-btn" onclick="formatDocIn('promotionDescription', 'italic')"><em>I</em></button>
              <button class="editor-btn" onclick="formatDocIn('promotionDescription', 'insertUnorderedList')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg></button>
            </div>
            <div class="editor-content" id="promotionDescription" contenteditable="true" style="min-height:80px;"></div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Type</label>
            <select class="form-select" id="promotionType"><option value="promo">Promo</option><option value="discount">Discount</option></select>
          </div>
          <div class="form-group">
            <label class="form-label">Discount Label</label>
            <input type="text" class="form-input" id="promotionDiscount" placeholder="e.g., 20% Off">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Start Date *</label>
            <input type="date" class="form-input" id="promotionStartDate">
          </div>
          <div class="form-group">
            <label class="form-label">End Date</label>
            <input type="date" class="form-input" id="promotionEndDate">
            <span class="form-hint">Leave blank for ongoing</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('promotion')">Cancel</button>
        <button class="btn btn-primary" onclick="savePromotion()">Save</button>
      </div>
    </div>
  </div>

  <!-- Policy Modal -->
  <div class="modal-overlay" id="policyModal" onclick="closeModalOnOverlay(event, 'policy')">
    <div class="modal">
      <div class="modal-header">
        <h2 id="policyModalTitle">Add Policy</h2>
        <button class="modal-close" onclick="closeModal('policy')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="policyId">
        <div class="form-group">
          <label class="form-label">Title *</label>
          <input type="text" class="form-input" id="policyTitle" placeholder="Enter title">
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <div class="editor-container">
            <div class="editor-toolbar">
              <button class="editor-btn" onclick="formatDocIn('policyDescription', 'bold')"><strong>B</strong></button>
              <button class="editor-btn" onclick="formatDocIn('policyDescription', 'italic')"><em>I</em></button>
              <button class="editor-btn" onclick="formatDocIn('policyDescription', 'insertUnorderedList')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg></button>
            </div>
            <div class="editor-content" id="policyDescription" contenteditable="true" style="min-height:80px;"></div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Category</label>
            <select class="form-select" id="policyCategory"><option value="">Select category...</option></select>
          </div>
          <div class="form-group">
            <label class="form-label">Document URL</label>
            <input type="text" class="form-input" id="policyUrl" placeholder="https://...">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('policy')">Cancel</button>
        <button class="btn btn-primary" onclick="savePolicy()">Save</button>
      </div>
    </div>
  </div>

  <!-- Category Modal -->
  <div class="modal-overlay" id="categoryModal" onclick="closeModalOnOverlay(event, 'category')">
    <div class="modal">
      <div class="modal-header">
        <h2>Manage Categories</h2>
        <button class="modal-close" onclick="closeModal('category')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Add New Category</label>
          <div style="display:flex;gap:10px;">
            <input type="text" class="form-input" id="newCategoryName" placeholder="Category name" style="flex:1;">
            <button class="btn btn-primary" onclick="addCategory()">Add</button>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Existing Categories</label>
          <div class="category-pills" id="categoryList"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('category')">Done</button>
      </div>
    </div>
  </div>

  <!-- Team Modal -->
  <div class="modal-overlay" id="teamModal" onclick="closeModalOnOverlay(event, 'team')">
    <div class="modal">
      <div class="modal-header">
        <h2 id="teamModalTitle">Add Team Member</h2>
        <button class="modal-close" onclick="closeModal('team')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="teamId">
        <div class="form-group">
          <label class="form-label">Photo</label>
          <div class="photo-upload">
            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face" class="photo-preview" id="teamPhotoPreview">
            <div class="photo-upload-btn">
              <input type="file" id="teamPhotoFile" accept="image/*" onchange="previewTeamPhoto(this)">
              <label for="teamPhotoFile"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg> Upload Photo</label>
              <input type="hidden" id="teamAvatarUrl">
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">First Name *</label>
            <input type="text" class="form-input" id="teamFirstName" placeholder="First name">
          </div>
          <div class="form-group">
            <label class="form-label">Last Name *</label>
            <input type="text" class="form-input" id="teamLastName" placeholder="Last name">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Role</label>
            <select class="form-select" id="teamRole"><option value="">Select role...</option></select>
          </div>
          <div class="form-group">
            <label class="form-label">Zone</label>
            <input type="text" class="form-input" id="teamZone" placeholder="e.g., North Region">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Email *</label>
            <input type="email" class="form-input" id="teamEmail" placeholder="email@example.com">
          </div>
          <div class="form-group">
            <label class="form-label">Phone Extension</label>
            <input type="text" class="form-input" id="teamExtension" placeholder="e.g., 1234">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('team')">Cancel</button>
        <button class="btn btn-primary" onclick="saveTeamMember()">Save</button>
      </div>
    </div>
  </div>

  <!-- Role Modal -->
  <div class="modal-overlay" id="roleModal" onclick="closeModalOnOverlay(event, 'role')">
    <div class="modal">
      <div class="modal-header">
        <h2 id="roleModalTitle">Add Role</h2>
        <button class="modal-close" onclick="closeModal('role')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="roleId">
        <div class="form-group">
          <label class="form-label">Role Name *</label>
          <input type="text" class="form-input" id="roleName" placeholder="e.g., Enrollment Director">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Badge Color</label>
            <div style="display:flex;align-items:center;gap:12px;">
              <input type="color" id="roleColor" value="#F97B5F" style="width:50px;height:36px;border:1px solid var(--color-border);border-radius:var(--radius-sm);cursor:pointer;">
              <input type="text" class="form-input" id="roleColorText" value="#F97B5F" style="flex:1;font-family:monospace;" onchange="document.getElementById('roleColor').value = this.value">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">&nbsp;</label>
            <label class="checkbox-label" style="margin-top:8px;"><input type="checkbox" id="roleFeatured"> Featured role</label>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Preview</label>
          <div style="padding:14px;background:var(--color-bg);border-radius:var(--radius-sm);">
            <span class="badge" id="rolePreviewBadge" style="background:rgba(249,123,95,0.1);color:#F97B5F;">Role Name</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('role')">Cancel</button>
        <button class="btn btn-primary" onclick="saveRole()">Save</button>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div class="modal-overlay" id="deleteModal" onclick="closeModalOnOverlay(event, 'delete')">
    <div class="modal" style="max-width:380px;">
      <div class="modal-header">
        <h2>Confirm Delete</h2>
        <button class="modal-close" onclick="closeModal('delete')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this? This cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('delete')">Cancel</button>
        <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    const SB_URL = 'https://kvyvjwepfrqqkvyyutdw.supabase.co';
    const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt2eXZqd2VwZnJxcWt2eXl1dGR3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcyMjgyOTgsImV4cCI6MjA4MjgwNDI5OH0.ZayLxzQCEFENvQ9FwpLm4x2le2Y9kJvSslX8DVRzAh8';
    
    let sb, deleteCallback = null, currentPromoTab = 'active';
    let announcements = [], promotions = [], teamMembers = [], roles = [], scriptContent = '', whatWeDoContent = '', workflowContent = '', workflowImageUrl = '';

    async function init() {
      sb = window.supabase.createClient(SB_URL, SB_KEY);
      await loadAllData();
    }

    async function loadAllData() {
      try {
        const [annRes, promoRes, teamRes, rolesRes, scriptRes, whatWeDoRes, workflowRes, workflowImgRes] = await Promise.all([
          sb.from('announcements').select('*').order('sort_order').order('date', { ascending: false }),
          sb.from('promotions').select('*').order('sort_order').order('start_date', { ascending: false }),
          sb.from('team_members').select('*').order('sort_order'),
          sb.from('roles').select('*').order('sort_order'),
          sb.from('content_blocks').select('*').eq('slug', 'enrollment_script').single(),
          sb.from('content_blocks').select('*').eq('slug', 'what_we_do').single(),
          sb.from('content_blocks').select('*').eq('slug', 'workflow').single(),
          sb.from('content_blocks').select('*').eq('slug', 'workflow_image').single()
        ]);
        announcements = annRes.data || [];
        promotions = promoRes.data || [];
        teamMembers = teamRes.data || [];
        roles = rolesRes.data || [];
        scriptContent = scriptRes.data?.content || '';
        whatWeDoContent = whatWeDoRes.data?.content || '';
        workflowContent = workflowRes.data?.content || '';
        workflowImageUrl = workflowImgRes.data?.content || '';
        renderAll();
      } catch (e) { console.error('Load error:', e); toast('Error loading data', 'error'); }
    }

    function renderAll() {
      renderAnnouncements();
      renderPromotions();
      renderTeam();
      renderRoles();
      document.getElementById('scriptEditor').innerHTML = scriptContent;
      document.getElementById('whatWeDoEditor').innerHTML = whatWeDoContent;
      document.getElementById('workflowEditor').innerHTML = workflowContent;
      
      // Workflow image
      if (workflowImageUrl) {
        document.getElementById('workflowImageImg').src = workflowImageUrl;
        document.getElementById('workflowImageImg').style.display = 'block';
        document.getElementById('workflowImagePlaceholder').style.display = 'none';
        document.getElementById('removeWorkflowImageBtn').style.display = 'inline-flex';
        document.getElementById('workflowImageUrl').value = workflowImageUrl;
      }
    }

    function esc(str) { if (!str) return ''; const div = document.createElement('div'); div.textContent = str; return div.innerHTML; }
    function formatDate(d) { if (!d) return '-'; return new Date(d).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }); }
    function getPromoStatus(p) { const now = new Date(); now.setHours(0,0,0,0); if (!p.start_date) return 'active'; const s = new Date(p.start_date), e = p.end_date ? new Date(p.end_date) : null; if (s > now) return 'upcoming'; if (e && e < now) return 'expired'; return 'active'; }

    // Announcements
    function renderAnnouncements() {
      const tbody = document.getElementById('announcementsList');
      if (!announcements.length) { tbody.innerHTML = `<tr><td colspan="4"><div class="empty-state"><div class="empty-state-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 4H5a2 2 0 00-2 2v14l4-4h12a2 2 0 002-2V6a2 2 0 00-2-2z"></path></svg></div><h3>No announcements</h3><p>Add your first announcement</p></div></td></tr>`; return; }
      tbody.innerHTML = announcements.map(a => `<tr><td><strong>${esc(a.title)}</strong></td><td>${formatDate(a.date)}</td><td><span class="badge ${a.is_active ? 'badge-success' : 'badge-muted'}">${a.is_active ? 'Active' : 'Inactive'}</span></td><td><div class="table-actions"><button class="action-btn" onclick="editAnnouncement('${a.id}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.83 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg></button><button class="action-btn delete" onclick="deleteItem('announcement','${a.id}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path></svg></button></div></td></tr>`).join('');
    }

    function editAnnouncement(id) { const a = announcements.find(x => x.id === id); if (!a) return; document.getElementById('announcementId').value = a.id; document.getElementById('announcementTitle').value = a.title || ''; document.getElementById('announcementContent').innerHTML = a.content || ''; document.getElementById('announcementDate').value = a.date || ''; document.getElementById('announcementActive').checked = a.is_active !== false; document.getElementById('announcementModalTitle').textContent = 'Edit Announcement'; openModal('announcement'); }

    async function saveAnnouncement() {
      const id = document.getElementById('announcementId').value;
      const data = { title: document.getElementById('announcementTitle').value.trim(), content: document.getElementById('announcementContent').innerHTML.trim(), date: document.getElementById('announcementDate').value || new Date().toISOString().split('T')[0], is_active: document.getElementById('announcementActive').checked };
      if (!data.title) { toast('Title required', 'error'); return; }
      try { if (id) await sb.from('announcements').update(data).eq('id', id); else { data.sort_order = announcements.length; await sb.from('announcements').insert(data); } await loadAllData(); closeModal('announcement'); resetAnnouncementForm(); toast('Saved!', 'success'); } catch (e) { console.error(e); toast('Error saving', 'error'); }
    }

    function resetAnnouncementForm() { document.getElementById('announcementId').value = ''; document.getElementById('announcementTitle').value = ''; document.getElementById('announcementContent').innerHTML = ''; document.getElementById('announcementDate').value = ''; document.getElementById('announcementActive').checked = true; document.getElementById('announcementModalTitle').textContent = 'Add Announcement'; }

    // Promotions
    function switchPromoTab(tab, btn) { currentPromoTab = tab; document.querySelectorAll('#promotions .tab-btn').forEach(b => b.classList.remove('active')); if (btn) btn.classList.add('active'); renderPromotions(); }

    function renderPromotions() {
      const tbody = document.getElementById('promotionsList');
      const filtered = promotions.filter(p => getPromoStatus(p) === currentPromoTab);
      if (!filtered.length) { tbody.innerHTML = `<tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"></path></svg></div><h3>No ${currentPromoTab} promotions</h3></div></td></tr>`; return; }
      tbody.innerHTML = filtered.map(p => `<tr><td><strong>${esc(p.title)}</strong></td><td><span class="badge badge-muted">${esc(p.type)}</span></td><td>${p.discount_label ? esc(p.discount_label) : '-'}</td><td>${formatDate(p.start_date)} - ${p.end_date ? formatDate(p.end_date) : 'Ongoing'}</td><td><div class="table-actions"><button class="action-btn" onclick="editPromotion('${p.id}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.83 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg></button><button class="action-btn delete" onclick="deleteItem('promotion','${p.id}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path></svg></button></div></td></tr>`).join('');
    }

    function editPromotion(id) { const p = promotions.find(x => x.id === id); if (!p) return; document.getElementById('promotionId').value = p.id; document.getElementById('promotionTitle').value = p.title || ''; document.getElementById('promotionDescription').innerHTML = p.description || ''; document.getElementById('promotionType').value = p.type || 'promo'; document.getElementById('promotionDiscount').value = p.discount_label || ''; document.getElementById('promotionStartDate').value = p.start_date || ''; document.getElementById('promotionEndDate').value = p.end_date || ''; document.getElementById('promotionModalTitle').textContent = 'Edit Promotion'; openModal('promotion'); }

    async function savePromotion() {
      const id = document.getElementById('promotionId').value;
      const data = { title: document.getElementById('promotionTitle').value.trim(), description: document.getElementById('promotionDescription').innerHTML.trim(), type: document.getElementById('promotionType').value, discount_label: document.getElementById('promotionDiscount').value.trim(), start_date: document.getElementById('promotionStartDate').value, end_date: document.getElementById('promotionEndDate').value || null };
      if (!data.title) { toast('Title required', 'error'); return; }
      try { if (id) await sb.from('promotions').update(data).eq('id', id); else { data.sort_order = promotions.length; await sb.from('promotions').insert(data); } await loadAllData(); closeModal('promotion'); resetPromotionForm(); toast('Saved!', 'success'); } catch (e) { console.error(e); toast('Error saving', 'error'); }
    }

    function resetPromotionForm() { document.getElementById('promotionId').value = ''; document.getElementById('promotionTitle').value = ''; document.getElementById('promotionDescription').innerHTML = ''; document.getElementById('promotionType').value = 'promo'; document.getElementById('promotionDiscount').value = ''; document.getElementById('promotionStartDate').value = ''; document.getElementById('promotionEndDate').value = ''; document.getElementById('promotionModalTitle').textContent = 'Add Promotion'; }

    // Policies
    function renderPolicies() {
      const tbody = document.getElementById('policiesList');
      if (!policies.length) { tbody.innerHTML = `<tr><td colspan="4"><div class="empty-state"><div class="empty-state-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path></svg></div><h3>No policies</h3><p>Add your first policy</p></div></td></tr>`; return; }
      tbody.innerHTML = policies.map(p => { const cat = categories.find(c => c.id === p.category_id); return `<tr><td><strong>${esc(p.title)}</strong></td><td>${cat ? esc(cat.name) : '<span style="color:var(--color-text-light);">Uncategorized</span>'}</td><td>${p.url ? `<a href="${esc(p.url)}" target="_blank" style="color:var(--color-coral);">View</a>` : '-'}</td><td><div class="table-actions"><button class="action-btn" onclick="editPolicy('${p.id}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.83 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg></button><button class="action-btn delete" onclick="deleteItem('policy','${p.id}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path></svg></button></div></td></tr>`; }).join('');
    }

    function editPolicy(id) { const p = policies.find(x => x.id === id); if (!p) return; document.getElementById('policyId').value = p.id; document.getElementById('policyTitle').value = p.title || ''; document.getElementById('policyDescription').innerHTML = p.description || ''; document.getElementById('policyCategory').value = p.category_id || ''; document.getElementById('policyUrl').value = p.url || ''; document.getElementById('policyModalTitle').textContent = 'Edit Policy'; renderCategoryDropdown(); document.getElementById('policyCategory').value = p.category_id || ''; openModal('policy'); }

    async function savePolicy() {
      const id = document.getElementById('policyId').value;
      const data = { title: document.getElementById('policyTitle').value.trim(), description: document.getElementById('policyDescription').innerHTML.trim(), category_id: document.getElementById('policyCategory').value || null, url: document.getElementById('policyUrl').value.trim() };
      if (!data.title) { toast('Title required', 'error'); return; }
      try { if (id) await sb.from('policies').update(data).eq('id', id); else { data.sort_order = policies.length; await sb.from('policies').insert(data); } await loadAllData(); closeModal('policy'); resetPolicyForm(); toast('Saved!', 'success'); } catch (e) { console.error(e); toast('Error saving', 'error'); }
    }

    function resetPolicyForm() { document.getElementById('policyId').value = ''; document.getElementById('policyTitle').value = ''; document.getElementById('policyDescription').innerHTML = ''; document.getElementById('policyCategory').value = ''; document.getElementById('policyUrl').value = ''; document.getElementById('policyModalTitle').textContent = 'Add Policy'; }

    // Categories
    function renderCategories() { const c = document.getElementById('categoryList'); renderCategoryDropdown(); if (!categories.length) { c.innerHTML = '<p style="color:var(--color-text-light);font-size:13px;">No categories yet</p>'; return; } c.innerHTML = categories.map(cat => `<div class="category-pill">${esc(cat.name)}<button class="delete-cat" onclick="deleteCategory('${cat.id}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div>`).join(''); }

    function renderCategoryDropdown() { const s = document.getElementById('policyCategory'); s.innerHTML = '<option value="">Select category...</option>' + categories.map(c => `<option value="${c.id}">${esc(c.name)}</option>`).join(''); }

    async function addCategory() { const name = document.getElementById('newCategoryName').value.trim(); if (!name) { toast('Enter name', 'error'); return; } try { await sb.from('policy_categories').insert({ name, sort_order: categories.length }); document.getElementById('newCategoryName').value = ''; await loadAllData(); toast('Added!', 'success'); } catch (e) { console.error(e); toast('Error', 'error'); } }

    async function deleteCategory(id) { if (!confirm('Delete this category?')) return; try { await sb.from('policies').update({ category_id: null }).eq('category_id', id); await sb.from('policy_categories').delete().eq('id', id); await loadAllData(); toast('Deleted', 'success'); } catch (e) { console.error(e); toast('Error', 'error'); } }

    // Team
    function renderTeam() {
      const c = document.getElementById('teamGrid');
      if (!teamMembers.length) { c.innerHTML = `<div class="empty-state" style="grid-column:1/-1;"><div class="empty-state-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path><circle cx="9" cy="7" r="4"></circle></svg></div><h3>No team members</h3><p>Add your first team member</p></div>`; return; }
      c.innerHTML = teamMembers.map(t => { const role = roles.find(r => r.id === t.role_id); const roleName = role ? role.name : (t.role || 'Team Member'); const roleColor = role ? role.color : '#6B7280'; const isFeatured = role ? role.is_featured : false; return `<div class="team-card ${isFeatured ? 'team-card-featured' : ''}" ${isFeatured ? `style="--featured-color:${roleColor}"` : ''}>${isFeatured ? `<div class="featured-banner" style="background:${roleColor}"> ${esc(roleName)}</div>` : ''}<div class="team-card-header" ${isFeatured ? 'style="margin-top:20px;"' : ''}><img src="${esc(t.avatar_url) || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face'}" class="team-avatar"><div class="team-info"><h4>${esc(t.first_name)} ${esc(t.last_name)}</h4><span class="badge" style="background:${roleColor}15;color:${roleColor};">${esc(roleName)}</span>${t.zone ? `<div class="zone">${esc(t.zone)}</div>` : ''}</div></div><div class="team-details"><div class="team-detail"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="16" x="2" y="4" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 01-2.06 0L2 7"></path></svg><a href="mailto:${esc(t.email)}">${esc(t.email)}</a></div>${t.phone_extension ? `<div class="team-detail"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"></path></svg>Ext. ${esc(t.phone_extension)}</div>` : ''}</div><div class="team-card-actions"><button class="action-btn" onclick="editTeamMember('${t.id}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.83 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg></button><button class="action-btn delete" onclick="deleteItem('team','${t.id}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path></svg></button></div></div>`; }).join('');
    }

    function renderRoleDropdown() { const s = document.getElementById('teamRole'); s.innerHTML = '<option value="">Select role...</option>' + roles.map(r => `<option value="${r.id}">${esc(r.name)}</option>`).join(''); }

    function editTeamMember(id) { const t = teamMembers.find(x => x.id === id); if (!t) return; document.getElementById('teamId').value = t.id; document.getElementById('teamFirstName').value = t.first_name || ''; document.getElementById('teamLastName').value = t.last_name || ''; renderRoleDropdown(); document.getElementById('teamRole').value = t.role_id || ''; document.getElementById('teamZone').value = t.zone || ''; document.getElementById('teamEmail').value = t.email || ''; document.getElementById('teamExtension').value = t.phone_extension || ''; document.getElementById('teamAvatarUrl').value = t.avatar_url || ''; document.getElementById('teamPhotoPreview').src = t.avatar_url || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face'; document.getElementById('teamModalTitle').textContent = 'Edit Team Member'; openModal('team'); }

    async function previewTeamPhoto(input) {
      if (input.files && input.files[0]) {
        const file = input.files[0];
        if (file.size > 10 * 1024 * 1024) { toast('Image must be under 10MB', 'error'); input.value = ''; return; }
        const reader = new FileReader(); reader.onload = e => { document.getElementById('teamPhotoPreview').src = e.target.result; }; reader.readAsDataURL(file);
        try {
          toast('Uploading...', '');
          const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${file.name.split('.').pop()}`;
          const { data, error } = await sb.storage.from('avatars').upload(fileName, file, { cacheControl: '3600', upsert: false });
          if (error) { toast('Error: ' + error.message, 'error'); return; }
          const { data: urlData } = sb.storage.from('avatars').getPublicUrl(fileName);
          document.getElementById('teamAvatarUrl').value = urlData.publicUrl;
          toast('Uploaded!', 'success');
        } catch (e) { console.error(e); toast('Error uploading', 'error'); }
      }
    }

    async function saveTeamMember() {
      const id = document.getElementById('teamId').value;
      const data = { first_name: document.getElementById('teamFirstName').value.trim(), last_name: document.getElementById('teamLastName').value.trim(), role_id: document.getElementById('teamRole').value || null, zone: document.getElementById('teamZone').value.trim(), email: document.getElementById('teamEmail').value.trim(), phone_extension: document.getElementById('teamExtension').value.trim(), avatar_url: document.getElementById('teamAvatarUrl').value.trim() };
      if (!data.first_name || !data.last_name || !data.email) { toast('Name and email required', 'error'); return; }
      try { if (id) await sb.from('team_members').update(data).eq('id', id); else { data.sort_order = teamMembers.length; await sb.from('team_members').insert(data); } await loadAllData(); closeModal('team'); resetTeamForm(); toast('Saved!', 'success'); } catch (e) { console.error(e); toast('Error saving', 'error'); }
    }

    function resetTeamForm() { document.getElementById('teamId').value = ''; document.getElementById('teamFirstName').value = ''; document.getElementById('teamLastName').value = ''; renderRoleDropdown(); document.getElementById('teamRole').value = ''; document.getElementById('teamZone').value = ''; document.getElementById('teamEmail').value = ''; document.getElementById('teamExtension').value = ''; document.getElementById('teamAvatarUrl').value = ''; document.getElementById('teamPhotoPreview').src = 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face'; document.getElementById('teamPhotoFile').value = ''; document.getElementById('teamModalTitle').textContent = 'Add Team Member'; }

    // Roles
    function renderRoles() {
      const tbody = document.getElementById('rolesList');
      if (!roles.length) { tbody.innerHTML = `<tr><td colspan="4"><div class="empty-state"><div class="empty-state-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle></svg></div><h3>No roles</h3><p>Add your first role</p></div></td></tr>`; return; }
      tbody.innerHTML = roles.map(r => `<tr><td><strong>${esc(r.name)}</strong></td><td><div style="display:flex;align-items:center;gap:8px;"><div style="width:22px;height:22px;background:${r.color};border-radius:4px;"></div><span style="font-family:monospace;font-size:13px;">${esc(r.color)}</span></div></td><td>${r.is_featured ? '<span class="badge badge-success"> Featured</span>' : '<span class="badge badge-muted">Standard</span>'}</td><td><div class="table-actions"><button class="action-btn" onclick="editRole('${r.id}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.83 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg></button><button class="action-btn delete" onclick="deleteItem('role','${r.id}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path></svg></button></div></td></tr>`).join('');
    }

    function editRole(id) { const r = roles.find(x => x.id === id); if (!r) return; document.getElementById('roleId').value = r.id; document.getElementById('roleName').value = r.name || ''; document.getElementById('roleColor').value = r.color || '#F97B5F'; document.getElementById('roleColorText').value = r.color || '#F97B5F'; document.getElementById('roleFeatured').checked = r.is_featured || false; updateRolePreview(); document.getElementById('roleModalTitle').textContent = 'Edit Role'; openModal('role'); }

    function updateRolePreview() { const name = document.getElementById('roleName').value || 'Role Name'; const color = document.getElementById('roleColor').value; document.getElementById('roleColorText').value = color; document.getElementById('rolePreviewBadge').textContent = name; document.getElementById('rolePreviewBadge').style.background = color + '15'; document.getElementById('rolePreviewBadge').style.color = color; }

    async function saveRole() {
      const id = document.getElementById('roleId').value;
      const data = { name: document.getElementById('roleName').value.trim(), color: document.getElementById('roleColor').value, is_featured: document.getElementById('roleFeatured').checked };
      if (!data.name) { toast('Name required', 'error'); return; }
      try { if (id) await sb.from('roles').update(data).eq('id', id); else { data.sort_order = roles.length; await sb.from('roles').insert(data); } await loadAllData(); closeModal('role'); resetRoleForm(); toast('Saved!', 'success'); } catch (e) { console.error(e); toast('Error saving', 'error'); }
    }

    function resetRoleForm() { document.getElementById('roleId').value = ''; document.getElementById('roleName').value = ''; document.getElementById('roleColor').value = '#F97B5F'; document.getElementById('roleColorText').value = '#F97B5F'; document.getElementById('roleFeatured').checked = false; document.getElementById('rolePreviewBadge').textContent = 'Role Name'; document.getElementById('rolePreviewBadge').style.background = 'rgba(249,123,95,0.1)'; document.getElementById('rolePreviewBadge').style.color = '#F97B5F'; document.getElementById('roleModalTitle').textContent = 'Add Role'; }

    // Script
    async function saveScript() { const content = document.getElementById('scriptEditor').innerHTML; try { await sb.from('content_blocks').upsert({ slug: 'enrollment_script', content, updated_at: new Date().toISOString() }, { onConflict: 'slug' }); scriptContent = content; toast('Saved!', 'success'); } catch (e) { console.error(e); toast('Error saving', 'error'); } }

    // What We Do
    async function saveWhatWeDo() { 
      const content = document.getElementById('whatWeDoEditor').innerHTML; 
      try { 
        await sb.from('content_blocks').upsert({ slug: 'what_we_do', content, updated_at: new Date().toISOString() }, { onConflict: 'slug' });
        whatWeDoContent = content; 
        toast('Saved!', 'success'); 
      } catch (e) { console.error(e); toast('Error saving', 'error'); } 
    }

    // Workflow
    async function saveWorkflow() { 
      const content = document.getElementById('workflowEditor').innerHTML; 
      const imageUrl = document.getElementById('workflowImageUrl').value;
      try { 
        await Promise.all([
          sb.from('content_blocks').upsert({ slug: 'workflow', content, updated_at: new Date().toISOString() }, { onConflict: 'slug' }),
          sb.from('content_blocks').upsert({ slug: 'workflow_image', content: imageUrl, updated_at: new Date().toISOString() }, { onConflict: 'slug' })
        ]);
        workflowContent = content;
        workflowImageUrl = imageUrl;
        toast('Saved!', 'success'); 
      } catch (e) { console.error(e); toast('Error saving', 'error'); } 
    }

    // Workflow image preview
    async function previewWorkflowImage(input) {
      if (input.files && input.files[0]) {
        const file = input.files[0];
        if (file.size > 10 * 1024 * 1024) { toast('Image must be under 10MB', 'error'); input.value = ''; return; }
        
        const reader = new FileReader();
        reader.onload = e => {
          document.getElementById('workflowImageImg').src = e.target.result;
          document.getElementById('workflowImageImg').style.display = 'block';
          document.getElementById('workflowImagePlaceholder').style.display = 'none';
          document.getElementById('removeWorkflowImageBtn').style.display = 'inline-flex';
        };
        reader.readAsDataURL(file);
        
        try {
          toast('Uploading...', '');
          const fileName = `workflow-${Date.now()}.${file.name.split('.').pop()}`;
          const { data, error } = await sb.storage.from('avatars').upload(fileName, file, { cacheControl: '3600', upsert: false });
          if (error) { toast('Error: ' + error.message, 'error'); return; }
          const { data: urlData } = sb.storage.from('avatars').getPublicUrl(fileName);
          document.getElementById('workflowImageUrl').value = urlData.publicUrl;
          toast('Uploaded! Click Save to confirm.', 'success');
        } catch (e) { console.error(e); toast('Error uploading', 'error'); }
      }
    }

    function removeWorkflowImage() {
      document.getElementById('workflowImageImg').src = '';
      document.getElementById('workflowImageImg').style.display = 'none';
      document.getElementById('workflowImagePlaceholder').style.display = 'flex';
      document.getElementById('removeWorkflowImageBtn').style.display = 'none';
      document.getElementById('workflowImageUrl').value = '';
      document.getElementById('workflowImageFile').value = '';
    }

    // Formatting
    function formatDoc(cmd) { document.execCommand(cmd, false, null); }
    function formatBlock(tag) { document.execCommand('formatBlock', false, tag); }
    function formatDocIn(id, cmd) { document.getElementById(id).focus(); document.execCommand(cmd, false, null); }

    // Delete
    function deleteItem(type, id) { deleteCallback = async () => { const tables = { announcement: 'announcements', promotion: 'promotions', policy: 'policies', team: 'team_members', role: 'roles' }; try { await sb.from(tables[type]).delete().eq('id', id); await loadAllData(); toast('Deleted', 'success'); } catch (e) { console.error(e); toast('Error', 'error'); } }; openModal('delete'); }
    function confirmDelete() { if (deleteCallback) deleteCallback(); closeModal('delete'); deleteCallback = null; }

    // Modals
    function openModal(type) { if (type === 'policy') renderCategoryDropdown(); if (type === 'team') renderRoleDropdown(); if (type === 'role') { document.getElementById('roleName').oninput = updateRolePreview; document.getElementById('roleColor').oninput = updateRolePreview; } document.getElementById(type + 'Modal').classList.add('active'); }
    function closeModal(type) { document.getElementById(type + 'Modal').classList.remove('active'); if (type === 'announcement') resetAnnouncementForm(); if (type === 'promotion') resetPromotionForm(); if (type === 'policy') resetPolicyForm(); if (type === 'team') resetTeamForm(); if (type === 'role') resetRoleForm(); }
    function closeModalOnOverlay(e, type) { if (e.target === e.currentTarget) closeModal(type); }

    // Navigation
    function switchSection(id, el) { document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active')); if (el) el.classList.add('active'); document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); closeSidebar(); }

    // Mobile
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('sidebarOverlay').classList.toggle('open'); }
    function closeSidebar() { document.getElementById('sidebar').classList.remove('open'); document.getElementById('sidebarOverlay').classList.remove('open'); }

    // Toast
    function toast(msg, type = '') { const t = document.getElementById('toast'); t.textContent = msg; t.className = 'toast show ' + type; setTimeout(() => t.classList.remove('show'), 3000); }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
