<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Directory - Enrollment Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #FA8072;
            --primary-light: #FFB4A2;
            --primary-dark: #E96E5D;
            --secondary: #FF6B9D;
            --secondary-light: #FFB6C1;
            --accent: #FFA07A;
            --accent-light: #FFCBA4;
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8F9FA;
            --text-primary: #2D3748;
            --text-secondary: #718096;
            --text-light: #A0AEC0;
            --white: #FFFFFF;
            --gray-50: #F8F9FA;
            --gray-100: #F1F3F5;
            --gray-200: #E9ECEF;
            --gray-300: #DEE2E6;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --shadow-sm: 0 2px 4px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 12px 0 rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 30px 0 rgba(0, 0, 0, 0.12);
            --shadow-xl: 0 20px 40px 0 rgba(0, 0, 0, 0.15);
            --sidebar-width: 260px;
            --sidebar-collapsed: 70px;
            --transition-speed: 0.3s;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #F8F9FA;
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            position: fixed; top: 0; left: 0;
            width: var(--sidebar-width); height: 100vh;
            background: var(--white);
            border-right: 1px solid var(--gray-200);
            box-shadow: var(--shadow-sm);
            transition: transform var(--transition-speed) ease, width var(--transition-speed) ease;
            z-index: 1000;
            display: flex; flex-direction: column;
        }
        .sidebar.collapsed { width: var(--sidebar-collapsed); }

        .sidebar-header {
            padding: 1.5rem 1.25rem;
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 1px solid var(--gray-200);
        }
        .logo-section { display: flex; align-items: center; gap: 0.75rem; transition: opacity var(--transition-speed) ease; }
        .sidebar.collapsed .logo-section { opacity: 0; pointer-events: none; }
        .logo-icon {
            width: 40px; height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem; flex-shrink: 0; color: var(--white); font-weight: 700;
        }
        .logo-text { font-size: 1.25rem; font-weight: 700; color: var(--text-primary); white-space: nowrap; }
        .toggle-btn {
            width: 32px; height: 32px; border: 1px solid var(--gray-200);
            background: var(--white); color: var(--text-secondary); border-radius: 6px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease; flex-shrink: 0;
        }
        .toggle-btn:hover { background: var(--gray-50); border-color: var(--gray-300); }
        .sidebar.collapsed .toggle-icon { transform: rotate(180deg); }
        .toggle-icon { transition: transform var(--transition-speed) ease; font-size: 1rem; }

        .sidebar-nav { flex: 1; overflow-y: auto; overflow-x: hidden; padding: 1rem 0; }
        .sidebar-nav::-webkit-scrollbar { width: 4px; }
        .sidebar-nav::-webkit-scrollbar-track { background: transparent; }
        .sidebar-nav::-webkit-scrollbar-thumb { background: var(--gray-300); border-radius: 2px; }

        .nav-item {
            display: flex; align-items: center; gap: 0.875rem;
            padding: 0.875rem 1.5rem; margin: 0.25rem 0.75rem;
            color: var(--text-secondary); text-decoration: none; border-radius: 10px;
            transition: all 0.2s ease; cursor: pointer; border: none;
            background: transparent; width: calc(100% - 1.5rem);
            font-size: 0.9375rem; font-weight: 500;
        }
        .nav-item:hover { background: var(--gray-100); color: var(--text-primary); }
        .nav-item.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: var(--white); box-shadow: 0 4px 12px rgba(250, 128, 114, 0.3);
        }
        .nav-icon { font-size: 1.25rem; flex-shrink: 0; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; }
        .nav-text { white-space: nowrap; transition: opacity var(--transition-speed) ease; }
        .sidebar.collapsed .nav-text { opacity: 0; pointer-events: none; }
        .sidebar.collapsed .nav-item { justify-content: center; padding: 0.875rem; }
        .sidebar-footer { padding: 0.5rem 0 1rem 0; border-top: 1px solid var(--gray-200); }
        .logout-btn { color: var(--secondary) !important; }
        .logout-btn:hover { background: rgba(255, 107, 157, 0.1) !important; }
        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); z-index: 999;
            opacity: 0; pointer-events: none; transition: opacity var(--transition-speed) ease;
        }
        .sidebar-overlay.active { opacity: 1; pointer-events: all; }

        .main-content {
            margin-left: var(--sidebar-width); min-height: 100vh; padding: 2rem 2.5rem;
            transition: margin-left var(--transition-speed) ease;
        }
        .sidebar.collapsed ~ .main-content { margin-left: var(--sidebar-collapsed); }

        /* Page Header */
        .page-header { margin-bottom: 2rem; }
        .page-header h1 { font-size: 2rem; color: var(--text-primary); margin-bottom: 0.5rem; font-weight: 700; letter-spacing: -0.02em; }
        .page-header p { color: var(--text-secondary); font-size: 1rem; }

        /* Filter Section */
        .filter-section {
            background: var(--white); border-radius: 16px; padding: 1.5rem;
            box-shadow: var(--shadow-md); margin-bottom: 1.5rem;
        }
        .filter-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 1rem; cursor: pointer; user-select: none;
        }
        .filter-header h3 { font-size: 1rem; font-weight: 700; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem; }
        .filter-header h3 i { color: var(--primary); }
        .filter-toggle { color: var(--text-secondary); font-size: 0.875rem; transition: transform 0.2s ease; }
        .filter-toggle.collapsed { transform: rotate(-90deg); }

        /* Reset Filters Button */
        .reset-filters-btn {
            display: flex; align-items: center; gap: 0.375rem;
            padding: 0.5rem 0.875rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white; border: none; border-radius: 8px;
            font-size: 0.8125rem; font-weight: 600;
            cursor: pointer; transition: all 0.2s;
            box-shadow: 0 2px 6px rgba(250, 128, 114, 0.3);
        }
        .reset-filters-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(250, 128, 114, 0.4);
        }
        .reset-filters-btn i { font-size: 0.75rem; }

        .filter-body { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
        .filter-body.collapsed { display: none; }

        .search-input-wrapper { position: relative; grid-column: 1 / -1; }
        .search-input-wrapper i { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--primary); }
        .search-input {
            width: 100%; padding: 0.75rem 1rem 0.75rem 2.75rem;
            background: var(--gray-50); border: 1.5px solid var(--gray-200);
            border-radius: 10px; font-size: 0.9375rem; color: var(--text-primary); transition: all 0.2s ease;
        }
        .search-input:focus { outline: none; border-color: var(--primary); background: var(--white); box-shadow: 0 0 0 3px rgba(250, 128, 114, 0.1); }

        .filter-group label {
            display: block; font-size: 0.75rem; font-weight: 600;
            color: var(--text-secondary); margin-bottom: 0.375rem; text-transform: uppercase; letter-spacing: 0.03em;
        }
        .filter-select {
            width: 100%; padding: 0.625rem 0.875rem;
            border: 1.5px solid var(--gray-200); border-radius: 10px;
            font-size: 0.875rem; color: var(--text-primary); background: var(--white); transition: all 0.2s ease;
        }
        .filter-select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(250, 128, 114, 0.1); }

        .active-filters { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1rem; grid-column: 1 / -1; }
        .active-filters:empty { display: none; }
        .filter-chip {
            display: inline-flex; align-items: center; gap: 0.375rem;
            padding: 0.375rem 0.75rem; background: rgba(250, 128, 114, 0.1);
            color: var(--primary-dark); border-radius: 20px; font-size: 0.8125rem; font-weight: 600;
        }
        .filter-chip button {
            background: none; border: none; color: var(--primary-dark); cursor: pointer;
            font-size: 0.875rem; padding: 0; line-height: 1; opacity: 0.7; transition: opacity 0.2s;
        }
        .filter-chip button:hover { opacity: 1; }
        .clear-all-btn {
            background: none; border: 1.5px solid var(--gray-200); color: var(--text-secondary);
            padding: 0.375rem 0.75rem; border-radius: 20px; font-size: 0.8125rem;
            font-weight: 600; cursor: pointer; transition: all 0.2s;
        }
        .clear-all-btn:hover { border-color: var(--danger); color: var(--danger); }

        /* Zone Filter Tabs */
        .zone-filter-tabs { display: flex; flex-wrap: wrap; gap: 0.5rem; grid-column: 1 / -1; margin-bottom: 0.25rem; }
        .zone-tab {
            padding: 0.5rem 1rem; font-size: 0.8125rem; font-weight: 600;
            color: var(--text-secondary); background: var(--gray-50);
            border: 1.5px solid var(--gray-200); border-radius: 20px;
            cursor: pointer; transition: all 0.2s ease;
        }
        .zone-tab:hover { border-color: var(--primary); color: var(--primary); }
        .zone-tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white; border-color: transparent;
            box-shadow: 0 2px 8px rgba(250, 128, 114, 0.3);
        }

        /* Results Info */
        .results-info {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem;
        }
        .results-count { font-size: 0.9375rem; color: var(--text-secondary); font-weight: 500; }
        .results-count strong { color: var(--text-primary); }
        .view-toggle { display: flex; gap: 0.25rem; }
        .view-btn {
            width: 36px; height: 36px; border: 1.5px solid var(--gray-200);
            background: var(--white); color: var(--text-secondary); border-radius: 8px;
            cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;
        }
        .view-btn.active { background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%); color: white; border-color: transparent; }
        .view-btn:hover:not(.active) { border-color: var(--primary); color: var(--primary); }

        /* Teachers Grid */
        .teachers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 1rem;
        }
        .teachers-grid.list-view { grid-template-columns: 1fr; }

        /* Teacher Card */
        .teacher-card {
            background: var(--white); border: 1px solid var(--gray-200);
            border-radius: 14px; overflow: hidden; box-shadow: var(--shadow-sm);
            transition: all 0.2s ease; display: flex; flex-direction: column;
        }
        .teacher-card:hover { border-color: var(--primary-light); box-shadow: var(--shadow-md); transform: translateY(-2px); }

        .teacher-card-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            padding: 1.25rem; color: white; position: relative;
        }
        .teacher-card-name { font-size: 1.125rem; font-weight: 700; margin-bottom: 0.125rem; }
        .teacher-card-brand { font-size: 0.8125rem; opacity: 0.9; }
        .teacher-card-status {
            position: absolute; top: 1rem; right: 1rem;
            padding: 0.2rem 0.625rem; border-radius: 12px; font-size: 0.6875rem;
            font-weight: 700; text-transform: uppercase; letter-spacing: 0.03em;
        }
        .status-active { background: rgba(255,255,255,0.25); color: white; }
        .status-inactive { background: rgba(0,0,0,0.15); color: rgba(255,255,255,0.8); }

        .teacher-card-body { padding: 1.25rem; flex: 1; display: flex; flex-direction: column; }

        .teacher-info-row {
            display: flex; align-items: center; gap: 0.625rem;
            padding: 0.4rem 0; font-size: 0.875rem;
        }
        .teacher-info-row i { color: var(--primary); width: 16px; text-align: center; font-size: 0.8125rem; }
        .teacher-info-row span { color: var(--text-secondary); line-height: 1.4; }

        .teacher-instruments-list { margin-top: 0.75rem; }
        .teacher-instruments-label { font-size: 0.75rem; font-weight: 700; color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 0.5rem; }

        .instrument-chip-row { display: flex; flex-wrap: wrap; gap: 0.375rem; }
        .instrument-chip {
            display: inline-flex; align-items: center; gap: 0.25rem;
            padding: 0.3rem 0.625rem; background: var(--gray-50);
            border: 1px solid var(--gray-200); border-radius: 8px;
            font-size: 0.75rem; font-weight: 600; color: var(--text-primary); transition: all 0.2s;
        }
        .instrument-chip .level-dot {
            width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0;
        }
        .level-beginner { background: var(--success); }
        .level-intermediate { background: var(--warning); }
        .level-advanced { background: var(--primary); }

        .teacher-badges { display: flex; flex-wrap: wrap; gap: 0.375rem; margin-top: auto; padding-top: 0.75rem; }
        .teacher-badge {
            padding: 0.2rem 0.5rem; border-radius: 6px;
            font-size: 0.6875rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.02em;
        }
        .badge-success { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .badge-info { background: rgba(250, 128, 114, 0.1); color: var(--primary); }
        .badge-purple { background: rgba(139, 92, 246, 0.1); color: #8B5CF6; }
        .badge-comfort { background: rgba(59, 130, 246, 0.1); color: #3B82F6; }

        /* Comfort Level Mini Display */
        .comfort-indicator {
            display: inline-flex; align-items: center; gap: 0.25rem;
            padding: 0.2rem 0.5rem; border-radius: 6px;
            font-size: 0.6875rem; font-weight: 600;
            background: rgba(139, 92, 246, 0.1); color: #8B5CF6;
        }
        .comfort-indicator i { font-size: 0.625rem; }

        /* Teacher Detail Modal */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000;
            align-items: center; justify-content: center; padding: 1rem;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white; border-radius: 16px; max-width: 700px; width: 100%;
            max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-xl);
        }
        .modal-header {
            padding: 1.5rem; border-bottom: 1px solid var(--gray-200);
            display: flex; align-items: center; justify-content: space-between;
            position: sticky; top: 0; background: white; z-index: 10;
        }
        .modal-title { font-size: 1.5rem; font-weight: 700; color: var(--text-primary); }
        .modal-close {
            width: 32px; height: 32px; border: none; background: var(--gray-100);
            color: var(--text-secondary); border-radius: 8px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: all 0.2s;
        }
        .modal-close:hover { background: var(--gray-200); }
        .modal-body { padding: 1.5rem; }

        .detail-section { margin-bottom: 1.5rem; }
        .detail-section-title {
            font-size: 0.8125rem; font-weight: 700; color: var(--primary);
            text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem;
            padding-bottom: 0.5rem; border-bottom: 2px solid var(--gray-100);
        }
        .detail-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
        .detail-item label { display: block; font-size: 0.75rem; font-weight: 600; color: var(--text-light); margin-bottom: 0.125rem; }
        .detail-item p { font-size: 0.9375rem; color: var(--text-primary); }

        .detail-instrument-card {
            background: var(--gray-50); border: 1px solid var(--gray-200);
            border-radius: 10px; padding: 1rem; margin-bottom: 0.75rem;
        }
        .detail-instrument-name { font-size: 1rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem; }
        .detail-instrument-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; }
        .detail-instrument-grid label { font-size: 0.6875rem; }
        .detail-instrument-grid p { font-size: 0.8125rem; }

        .strength-item {
            display: flex; align-items: flex-start; gap: 0.5rem;
            padding: 0.5rem 0; font-size: 0.9375rem; color: var(--text-primary);
        }
        .strength-item i { color: var(--primary); margin-top: 0.125rem; font-size: 0.75rem; }

        /* Comfort Level Display in Modal */
        .comfort-level-display {
            display: flex; align-items: center; gap: 1rem;
            padding: 1rem; background: var(--gray-50); border-radius: 10px;
            margin-bottom: 1rem;
        }
        .comfort-level-bar {
            flex: 1; height: 8px; background: var(--gray-200); border-radius: 4px;
            overflow: hidden;
        }
        .comfort-level-fill {
            height: 100%; border-radius: 4px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
        }
        .comfort-level-value {
            font-size: 1.25rem; font-weight: 700; color: var(--primary);
            min-width: 50px; text-align: center;
        }
        .comfort-level-label {
            font-size: 0.875rem; color: var(--text-secondary);
        }

        /* Empty & Loading */
        .empty-state { text-align: center; padding: 3rem 1.5rem; color: var(--text-secondary); }
        .empty-state i { font-size: 3rem; color: var(--gray-300); margin-bottom: 0.75rem; }
        .empty-state p { font-size: 1rem; }
        .loading { display: flex; align-items: center; justify-content: center; min-height: 400px; color: var(--text-secondary); font-size: 1.125rem; }

        /* Instrument Checkbox Filter */
        .instrument-filter-section {
            grid-column: 1 / -1;
            margin-top: 0.5rem;
        }
        .instrument-filter-label {
            font-size: 0.75rem; font-weight: 600;
            color: var(--text-secondary); margin-bottom: 0.5rem;
            text-transform: uppercase; letter-spacing: 0.03em;
        }
        .instrument-checkbox-grid {
            display: flex; flex-wrap: wrap; gap: 0.5rem;
        }
        .instrument-checkbox {
            display: flex; align-items: center; gap: 0.375rem;
            padding: 0.5rem 0.75rem; background: var(--gray-50);
            border: 1.5px solid var(--gray-200); border-radius: 8px;
            cursor: pointer; transition: all 0.2s; user-select: none;
            font-size: 0.8125rem; font-weight: 500; color: var(--text-primary);
        }
        .instrument-checkbox:hover { border-color: var(--primary-light); }
        .instrument-checkbox.selected {
            border-color: var(--primary);
            background: rgba(250, 128, 114, 0.1);
            color: var(--primary-dark);
        }
        .instrument-checkbox .check-icon {
            width: 16px; height: 16px;
            border: 2px solid var(--gray-300); border-radius: 3px;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.625rem; color: transparent; transition: all 0.2s;
            flex-shrink: 0;
        }
        .instrument-checkbox.selected .check-icon {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-color: transparent; color: white;
        }
        .selected-instruments-info {
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-light);
            font-style: italic;
        }

        /* List view card adjustments */
        .teachers-grid.list-view .teacher-card { flex-direction: row; }
        .teachers-grid.list-view .teacher-card-header { min-width: 220px; display: flex; flex-direction: column; justify-content: center; }
        .teachers-grid.list-view .teacher-card-body { flex-direction: row; flex-wrap: wrap; gap: 1rem; align-items: center; }

        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar:not(.collapsed) { transform: translateX(0); }
            .main-content { margin-left: 0; padding: 1.5rem; }
            .sidebar.collapsed ~ .main-content { margin-left: 0; }
            .teachers-grid { grid-template-columns: 1fr; }
            .teachers-grid.list-view .teacher-card { flex-direction: column; }
            .teachers-grid.list-view .teacher-card-header { min-width: unset; }
            .filter-body { grid-template-columns: 1fr 1fr; }
            .detail-grid, .detail-instrument-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 500px) {
            .filter-body { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <div class="logo-section">
                <div class="logo-icon">EH</div>
                <span class="logo-text">Enrollment Hub</span>
            </div>
            <button id="sidebarToggle" class="toggle-btn">
                <span class="toggle-icon">‹</span>
            </button>
        </div>

        <nav class="sidebar-nav">
            <a href="teamdashboard.html" class="nav-item active">
                <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
                <span class="nav-text">Dashboard</span>
            </a>
            <a href="teamquicklinks.html" class="nav-item">
                <span class="nav-icon"><i class="fas fa-link"></i></span>
                <span class="nav-text">Quick Links</span>
            </a>
            <a href="teamstudio-directory.html" class="nav-item">
                <span class="nav-icon"><i class="fas fa-building"></i></span>
                <span class="nav-text">Studio Directory</span>
            </a>
            <a href="teamteachers.html" class="nav-item">
                <span class="nav-icon"><i class="fas fa-star"></i></span>
                <span class="nav-text">Teacher Directory</span>
            </a>
            <a href="teammap.html" class="nav-item">
                <span class="nav-icon"><i class="fas fa-map-marked-alt"></i></span>
                <span class="nav-text">Map</span>
            </a>
            <a href="teamprograms.html" class="nav-item">
                <span class="nav-icon"><i class="fas fa-graduation-cap"></i></span>
                <span class="nav-text">Programs</span>
            </a>
            <a href="teamsnippets.html" class="nav-item">
                <span class="nav-icon"><i class="fas fa-file-alt"></i></span>
                <span class="nav-text">Snippets</span>
            </a>
            <a href="teamtraining-hub.html" class="nav-item">
                <span class="nav-icon"><i class="fas fa-book-open"></i></span>
                <span class="nav-text">Training</span>
            </a>
        </nav>
            <a href="EnsembleDirectors.html" class="nav-item">
                <span class="nav-icon"><i class="far fa-user"></i></span>
                <span class="nav-text">Directors Page</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <button id="logoutBtn" class="nav-item logout-btn">
                <span class="nav-icon"><i class="fas fa-sign-out-alt"></i></span>
                <span class="nav-text">Logout</span>
            </button>
        </div>
    </div>

    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <main class="main-content">
        <div class="page-header">
            <h1>Teacher Directory</h1>
            <p>Find the right teacher by instrument, level, location, and more</p>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-header" onclick="toggleFilters()">
                <h3><i class="fas fa-sliders-h"></i> Filters</h3>
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <button class="reset-filters-btn" onclick="event.stopPropagation(); clearAllFilters();" title="Reset all filters">
                        <i class="fas fa-redo-alt"></i> Reset
                    </button>
                    <i id="filterToggleIcon" class="fas fa-chevron-down filter-toggle"></i>
                </div>
            </div>
            <div id="filterBody" class="filter-body">
                <!-- Search -->
                <div class="search-input-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="teacherSearch" class="search-input" placeholder="Search by teacher name...">
                </div>

                <!-- Zone Tabs -->
                <div class="zone-filter-tabs" id="zoneFilterTabs"></div>

                <!-- Dropdowns -->
                <div class="filter-group">
                    <label>State</label>
                    <select id="filterState" class="filter-select" onchange="onStateFilterChange()"><option value="">All States</option></select>
                </div>
                <div class="filter-group">
                    <label>Brand / Studio</label>
                    <select id="filterBrand" class="filter-select" onchange="onBrandFilterChange()"><option value="">All Brands</option></select>
                </div>
                <div class="filter-group">
                    <label>City</label>
                    <select id="filterCity" class="filter-select"><option value="">All Cities</option></select>
                </div>
                
                <!-- Instrument Checkboxes -->
                <div class="instrument-filter-section">
                    <div class="instrument-filter-label">Instruments (select multiple to find teachers who teach ALL selected)</div>
                    <div id="instrumentCheckboxGrid" class="instrument-checkbox-grid"></div>
                    <div id="selectedInstrumentsInfo" class="selected-instruments-info"></div>
                </div>
                
                <div class="filter-group">
                    <label>Highest Level</label>
                    <select id="filterLevel" class="filter-select">
                        <option value="">All Levels</option>
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Genre</label>
                    <select id="filterGenre" class="filter-select"><option value="">All Genres</option></select>
                </div>
                <div class="filter-group">
                    <label>Student Age</label>
                    <select id="filterAge" class="filter-select">
                        <option value="">Any Age</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Language</label>
                    <select id="filterLanguage" class="filter-select"><option value="">All Languages</option></select>
                </div>
                <div class="filter-group">
                    <label>Neurodiverse Comfort</label>
                    <select id="filterComfort" class="filter-select">
                        <option value="">Any Comfort Level</option>
                        <option value="5">5+ (Some Experience)</option>
                        <option value="6">6+ (Moderate)</option>
                        <option value="7">7+ (Comfortable)</option>
                        <option value="8">8+ (Very Comfortable)</option>
                        <option value="9">9+ (Highly Experienced)</option>
                        <option value="10">10 (Expert)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Special Needs</label>
                    <select id="filterSpecialNeeds" class="filter-select">
                        <option value="">Any</option>
                        <option value="yes">Willing to Teach</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Formal Education</label>
                    <select id="filterFormalEd" class="filter-select">
                        <option value="">Any</option>
                        <option value="yes">Has Formal Education</option>
                    </select>
                </div>

                <!-- Active Filters -->
                <div id="activeFilters" class="active-filters"></div>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading">
            <i class="fas fa-spinner fa-spin" style="margin-right: 0.5rem;"></i> Loading...
        </div>

        <!-- Results -->
        <div id="content" style="display: none;">
            <div class="results-info">
                <span id="resultsCount" class="results-count"></span>
                <div class="view-toggle">
                    <button class="view-btn active" id="gridViewBtn" onclick="setView('grid')" title="Grid view">
                        <i class="fas fa-th-large"></i>
                    </button>
                    <button class="view-btn" id="listViewBtn" onclick="setView('list')" title="List view">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>
            <div id="teachersGrid" class="teachers-grid"></div>
        </div>
    </main>

    <!-- Teacher Detail Modal -->
    <div id="teacherModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTeacherName"></h3>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://kvyvjwepfrqqkvyyutdw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt2eXZqd2VwZnJxcWt2eXl1dGR3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcyMjgyOTgsImV4cCI6MjA4MjgwNDI5OH0.ZayLxzQCEFENvQ9FwpLm4x2le2Y9kJvSslX8DVRzAh8';

        let supabaseClient;
        let teachers = [];
        let brands = [];
        let zones = [];
        let currentView = 'grid';
        let activeZone = 'all';
        let selectedInstruments = []; // Array of selected instrument names for multi-select

        document.addEventListener('DOMContentLoaded', () => {
            supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            setupSidebar();
            setupFilterListeners();
            loadData();
        });

        function setupSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('sidebarToggle');
            const overlay = document.getElementById('sidebarOverlay');
            const logoutBtn = document.getElementById('logoutBtn');

            toggleBtn.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
                if (window.innerWidth <= 768 && !sidebar.classList.contains('collapsed')) {
                    overlay.classList.add('active');
                } else {
                    overlay.classList.remove('active');
                }
            });
            overlay.addEventListener('click', () => {
                sidebar.classList.add('collapsed');
                overlay.classList.remove('active');
            });
            logoutBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to logout?')) {
                    window.location.href = 'index.html';
                }
            });
        }

        function setupFilterListeners() {
            document.getElementById('teacherSearch').addEventListener('input', applyFilters);
            [
                'filterCity', 
                'filterLevel', 'filterGenre', 'filterAge', 'filterLanguage',
                'filterComfort', 'filterSpecialNeeds', 'filterFormalEd'
            ].forEach(id => {
                document.getElementById(id).addEventListener('change', applyFilters);
            });
        }

        async function loadData() {
            try {
                const [teachersRes, citiesRes, languagesRes, instrumentsRes, brandsRes, zonesRes] = await Promise.all([
                    supabaseClient.from('teachers').select('*').eq('status', 'active').order('first_name'),
                    supabaseClient.from('teacher_cities').select('*'),
                    supabaseClient.from('teacher_languages').select('*'),
                    supabaseClient.from('teacher_instruments').select('*'),
                    supabaseClient.from('brands').select('*'),
                    supabaseClient.from('zones').select('*')
                ]);

                if (teachersRes.error) throw teachersRes.error;

                zones = zonesRes.data || [];
                brands = (brandsRes.data || []).map(b => ({
                    ...b,
                    zone: zones.find(z => z.id === b.zone_id)
                }));

                teachers = (teachersRes.data || []).map(t => {
                    const matchedBrand = brands.find(b => b.name === t.brand);
                    return {
                        ...t,
                        cities: (citiesRes.data || []).filter(c => c.teacher_id === t.id),
                        languages: (languagesRes.data || []).filter(l => l.teacher_id === t.id),
                        instruments: (instrumentsRes.data || []).filter(i => i.teacher_id === t.id),
                        brandData: matchedBrand || null,
                        zone: matchedBrand?.zone || null
                    };
                });

                populateFilterOptions();
                renderZoneTabs();

                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                applyFilters();
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').innerHTML = '<p style="color: red;">Error loading data. Please refresh.</p>';
            }
        }

        function populateFilterOptions() {
            // States - always show all states from teachers
            const states = [...new Set(teachers.map(t => t.state).filter(Boolean))].sort();
            populateSelect('filterState', states, 'All States');

            // Initial population of brands and cities (all)
            updateBrandOptions();
            updateCityOptions();

            // Instruments - render as checkboxes
            renderInstrumentCheckboxes();

            // Languages
            const languageNames = [...new Set(teachers.flatMap(t => t.languages.map(l => l.language)).filter(Boolean))].sort();
            populateSelect('filterLanguage', languageNames, 'All Languages');

            // Genres — split comma-separated values
            const allGenres = new Set();
            teachers.forEach(t => {
                t.instruments.forEach(i => {
                    if (i.genres) {
                        i.genres.split(',').forEach(g => {
                            const trimmed = g.trim();
                            if (trimmed) allGenres.add(trimmed);
                        });
                    }
                });
            });
            populateSelect('filterGenre', [...allGenres].sort(), 'All Genres');
        }

        function onStateFilterChange() {
            // Reset brand and city when state changes
            document.getElementById('filterBrand').value = '';
            document.getElementById('filterCity').value = '';
            updateBrandOptions();
            updateCityOptions();
            applyFilters();
        }

        function onBrandFilterChange() {
            // Reset city when brand changes
            document.getElementById('filterCity').value = '';
            updateCityOptions();
            applyFilters();
        }

        function updateBrandOptions() {
            const selectedState = document.getElementById('filterState').value;
            
            // Get brands based on state filter
            let filteredTeachers = teachers;
            if (selectedState) {
                filteredTeachers = teachers.filter(t => t.state === selectedState);
            }
            
            const brandNames = [...new Set(filteredTeachers.map(t => t.brand).filter(Boolean))].sort();
            const currentBrand = document.getElementById('filterBrand').value;
            populateSelect('filterBrand', brandNames, 'All Brands');
            
            // Restore selection if still valid
            if (brandNames.includes(currentBrand)) {
                document.getElementById('filterBrand').value = currentBrand;
            }
        }

        function updateCityOptions() {
            const selectedState = document.getElementById('filterState').value;
            const selectedBrand = document.getElementById('filterBrand').value;
            
            // Get cities based on state and brand filters
            let filteredTeachers = teachers;
            if (selectedState) {
                filteredTeachers = filteredTeachers.filter(t => t.state === selectedState);
            }
            if (selectedBrand) {
                filteredTeachers = filteredTeachers.filter(t => t.brand === selectedBrand);
            }
            
            const cityNames = [...new Set(filteredTeachers.flatMap(t => t.cities.map(c => c.city)).filter(Boolean))].sort();
            const currentCity = document.getElementById('filterCity').value;
            populateSelect('filterCity', cityNames, 'All Cities');
            
            // Restore selection if still valid
            if (cityNames.includes(currentCity)) {
                document.getElementById('filterCity').value = currentCity;
            }
        }

        function renderInstrumentCheckboxes() {
            const instrumentNames = [...new Set(teachers.flatMap(t => t.instruments.map(i => i.instrument)).filter(Boolean))].sort();
            const container = document.getElementById('instrumentCheckboxGrid');
            
            container.innerHTML = instrumentNames.map(inst => {
                const isSelected = selectedInstruments.includes(inst);
                return `
                    <div class="instrument-checkbox ${isSelected ? 'selected' : ''}" onclick="toggleInstrumentFilter('${inst}', this)">
                        <span class="check-icon"><i class="fas fa-check"></i></span>
                        <span>${inst}</span>
                    </div>
                `;
            }).join('');
            
            updateSelectedInstrumentsInfo();
        }

        function toggleInstrumentFilter(instrument, el) {
            const idx = selectedInstruments.indexOf(instrument);
            if (idx === -1) {
                selectedInstruments.push(instrument);
                el.classList.add('selected');
            } else {
                selectedInstruments.splice(idx, 1);
                el.classList.remove('selected');
            }
            updateSelectedInstrumentsInfo();
            applyFilters();
        }

        function updateSelectedInstrumentsInfo() {
            const info = document.getElementById('selectedInstrumentsInfo');
            if (selectedInstruments.length === 0) {
                info.textContent = '';
            } else if (selectedInstruments.length === 1) {
                info.textContent = `Showing teachers who teach: ${selectedInstruments[0]}`;
            } else {
                info.textContent = `Showing teachers who teach ALL of: ${selectedInstruments.join(', ')}`;
            }
        }

        function populateSelect(id, values, defaultLabel) {
            const select = document.getElementById(id);
            select.innerHTML = `<option value="">${defaultLabel}</option>`;
            values.forEach(v => {
                const opt = document.createElement('option');
                opt.value = v;
                opt.textContent = v;
                select.appendChild(opt);
            });
        }

        function renderZoneTabs() {
            const container = document.getElementById('zoneFilterTabs');
            const zonesWithTeachers = zones.filter(z =>
                teachers.some(t => t.zone && t.zone.id === z.id)
            );

            let html = `<button class="zone-tab ${activeZone === 'all' ? 'active' : ''}" onclick="filterByZone('all')">All Zones</button>`;
            html += zonesWithTeachers.map(z => `
                <button class="zone-tab ${activeZone === z.id ? 'active' : ''}" onclick="filterByZone('${z.id}')">
                    ${z.zone_name}
                </button>
            `).join('');
            container.innerHTML = html;
        }

        function filterByZone(zoneId) {
            activeZone = zoneId;
            renderZoneTabs();
            applyFilters();
        }

        function toggleFilters() {
            const body = document.getElementById('filterBody');
            const icon = document.getElementById('filterToggleIcon');
            body.classList.toggle('collapsed');
            icon.classList.toggle('collapsed');
        }

        function getActiveFilters() {
            const filters = {};
            const search = document.getElementById('teacherSearch').value.trim();
            if (search) filters.search = search;
            if (activeZone !== 'all') filters.zone = activeZone;

            [
                'filterState', 'filterBrand', 'filterCity', 
                'filterLevel', 'filterGenre', 'filterAge', 'filterLanguage',
                'filterComfort', 'filterSpecialNeeds', 'filterFormalEd'
            ].forEach(id => {
                const val = document.getElementById(id).value;
                if (val) filters[id] = val;
            });
            
            // Add selected instruments
            if (selectedInstruments.length > 0) {
                filters.selectedInstruments = [...selectedInstruments];
            }
            
            return filters;
        }

        function applyFilters() {
            const filters = getActiveFilters();
            const searchLower = (filters.search || '').toLowerCase();

            const filtered = teachers.filter(t => {
                // Name search
                if (searchLower && !`${t.first_name} ${t.last_name}`.toLowerCase().includes(searchLower)) return false;

                // Zone
                if (filters.zone && (!t.zone || t.zone.id !== filters.zone)) return false;

                // State
                if (filters.filterState && t.state !== filters.filterState) return false;

                // Brand
                if (filters.filterBrand && t.brand !== filters.filterBrand) return false;

                // City
                if (filters.filterCity && !t.cities.some(c => c.city === filters.filterCity)) return false;

                // Language
                if (filters.filterLanguage && !t.languages.some(l => l.language === filters.filterLanguage)) return false;

                // Instruments - must teach ALL selected instruments
                if (filters.selectedInstruments && filters.selectedInstruments.length > 0) {
                    const teacherInstruments = t.instruments.map(i => i.instrument);
                    const hasAllInstruments = filters.selectedInstruments.every(inst => 
                        teacherInstruments.includes(inst)
                    );
                    if (!hasAllInstruments) return false;
                }

                // Level — teacher has at least one instrument at or above this level
                if (filters.filterLevel) {
                    const levelOrder = { beginner: 1, intermediate: 2, advanced: 3 };
                    const targetLevel = levelOrder[filters.filterLevel] || 0;
                    let relevantInstruments = t.instruments;
                    // If instruments are selected, only check level for those instruments
                    if (filters.selectedInstruments && filters.selectedInstruments.length > 0) {
                        relevantInstruments = relevantInstruments.filter(i => 
                            filters.selectedInstruments.includes(i.instrument)
                        );
                    }
                    const hasLevel = relevantInstruments.some(i => (levelOrder[i.teacher_level] || 0) >= targetLevel);
                    if (!hasLevel) return false;
                }

                // Genre
                if (filters.filterGenre) {
                    let relevantInstruments = t.instruments;
                    // If instruments are selected, only check genres for those instruments
                    if (filters.selectedInstruments && filters.selectedInstruments.length > 0) {
                        relevantInstruments = relevantInstruments.filter(i => 
                            filters.selectedInstruments.includes(i.instrument)
                        );
                    }
                    const hasGenre = relevantInstruments.some(i =>
                        i.genres && i.genres.split(',').map(g => g.trim()).includes(filters.filterGenre)
                    );
                    if (!hasGenre) return false;
                }

                // Age — teacher accepts students at this age (youngest_age_preference <= selected age)
                if (filters.filterAge) {
                    const age = parseInt(filters.filterAge);
                    let relevantInstruments = t.instruments;
                    // If instruments are selected, only check age for those instruments
                    if (filters.selectedInstruments && filters.selectedInstruments.length > 0) {
                        relevantInstruments = relevantInstruments.filter(i => 
                            filters.selectedInstruments.includes(i.instrument)
                        );
                    }
                    const acceptsAge = relevantInstruments.some(i =>
                        i.youngest_age_preference && parseInt(i.youngest_age_preference) <= age
                    );
                    if (!acceptsAge) return false;
                }

                // Learning Needs Comfort Level
                if (filters.filterComfort) {
                    const minComfort = parseInt(filters.filterComfort);
                    if (!t.learning_needs_comfort || t.learning_needs_comfort < minComfort) return false;
                }

                // Special Needs Willing
                if (filters.filterSpecialNeeds === 'yes' && !t.special_needs_willing) return false;

                // Formal Education
                if (filters.filterFormalEd === 'yes' && !t.formal_music_education) return false;

                return true;
            });

            renderActiveFilters(filters);
            renderTeachers(filtered);
        }

        function renderActiveFilters(filters) {
            const container = document.getElementById('activeFilters');
            const chips = [];

            const labels = {
                zone: () => { const z = zones.find(z => z.id === filters.zone); return z ? `Zone: ${z.zone_name}` : null; },
                filterState: () => `State: ${filters.filterState}`,
                filterBrand: () => `Brand: ${filters.filterBrand}`,
                filterCity: () => `City: ${filters.filterCity}`,
                filterLevel: () => `Level: ${filters.filterLevel}`,
                filterGenre: () => `Genre: ${filters.filterGenre}`,
                filterAge: () => `Age: ${filters.filterAge}`,
                filterLanguage: () => `Language: ${filters.filterLanguage}`,
                filterComfort: () => `Comfort: ${filters.filterComfort}+`,
                filterSpecialNeeds: () => `Special Needs: Yes`,
                filterFormalEd: () => `Formal Education: Yes`,
            };

            Object.keys(labels).forEach(key => {
                if (filters[key]) {
                    const label = labels[key]();
                    if (label) {
                        const clearAction = key === 'zone'
                            ? `filterByZone('all')`
                            : `clearFilter('${key}')`;
                        chips.push(`<span class="filter-chip">${label}<button onclick="${clearAction}">&times;</button></span>`);
                    }
                }
            });
            
            // Add chips for each selected instrument
            if (filters.selectedInstruments) {
                filters.selectedInstruments.forEach(inst => {
                    chips.push(`<span class="filter-chip">Instrument: ${inst}<button onclick="clearInstrumentFilter('${inst}')">&times;</button></span>`);
                });
            }

            if (chips.length > 1) {
                chips.push(`<button class="clear-all-btn" onclick="clearAllFilters()">Clear All</button>`);
            }

            container.innerHTML = chips.join('');
        }

        function clearInstrumentFilter(instrument) {
            const idx = selectedInstruments.indexOf(instrument);
            if (idx !== -1) {
                selectedInstruments.splice(idx, 1);
            }
            renderInstrumentCheckboxes();
            applyFilters();
        }

        function clearFilter(filterId) {
            document.getElementById(filterId).value = '';
            
            // Handle cascading resets
            if (filterId === 'filterState') {
                document.getElementById('filterBrand').value = '';
                document.getElementById('filterCity').value = '';
                updateBrandOptions();
                updateCityOptions();
            } else if (filterId === 'filterBrand') {
                document.getElementById('filterCity').value = '';
                updateCityOptions();
            }
            
            applyFilters();
        }

        function clearAllFilters() {
            document.getElementById('teacherSearch').value = '';
            activeZone = 'all';
            renderZoneTabs();
            [
                'filterState', 'filterBrand', 'filterCity', 
                'filterLevel', 'filterGenre', 'filterAge', 'filterLanguage',
                'filterComfort', 'filterSpecialNeeds', 'filterFormalEd'
            ].forEach(id => {
                document.getElementById(id).value = '';
            });
            // Clear selected instruments
            selectedInstruments = [];
            renderInstrumentCheckboxes();
            // Reset cascading filters
            updateBrandOptions();
            updateCityOptions();
            applyFilters();
        }

        function setView(view) {
            currentView = view;
            const grid = document.getElementById('teachersGrid');
            grid.classList.toggle('list-view', view === 'list');
            document.getElementById('gridViewBtn').classList.toggle('active', view === 'grid');
            document.getElementById('listViewBtn').classList.toggle('active', view === 'list');
        }

        function renderTeachers(teachersList) {
            const container = document.getElementById('teachersGrid');
            document.getElementById('resultsCount').innerHTML = `<strong>${teachersList.length}</strong> teacher${teachersList.length !== 1 ? 's' : ''} found`;

            if (teachersList.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <p>No teachers match your filters</p>
                    </div>`;
                return;
            }

            container.innerHTML = teachersList.map(t => {
                const instrumentChips = t.instruments.map(i => `
                    <span class="instrument-chip">
                        <span class="level-dot level-${i.teacher_level || 'beginner'}"></span>
                        ${i.instrument}${i.teacher_level ? ` (${i.teacher_level})` : ''}
                    </span>
                `).join('');

                const cityList = t.cities.map(c => c.city).join(', ');
                const languageList = t.languages.map(l => l.language).join(', ');
                const comfortLevel = t.learning_needs_comfort;

                return `
                    <div class="teacher-card" onclick="openTeacherDetail('${t.id}')" style="cursor:pointer;">
                        <div class="teacher-card-header">
                            <div class="teacher-card-name">${t.first_name} ${t.last_name}</div>
                            <div class="teacher-card-brand">${t.brand || ''}${t.zone ? ' · ' + t.zone.zone_name : ''}</div>
                        </div>
                        <div class="teacher-card-body">
                            ${t.state ? `<div class="teacher-info-row"><i class="fas fa-map-marker-alt"></i><span>${t.state}${cityList ? ' — ' + cityList : ''}</span></div>` : ''}
                            ${languageList ? `<div class="teacher-info-row"><i class="fas fa-language"></i><span>${languageList}</span></div>` : ''}
                            ${comfortLevel ? `<div class="teacher-info-row"><i class="fas fa-heart"></i><span>Learning Needs Comfort: ${comfortLevel}/10</span></div>` : ''}
                            ${t.instruments.length > 0 ? `
                                <div class="teacher-instruments-list">
                                    <div class="teacher-instruments-label">Instruments</div>
                                    <div class="instrument-chip-row">${instrumentChips}</div>
                                </div>
                            ` : ''}
                            <div class="teacher-badges">
                                ${t.formal_music_education ? '<span class="teacher-badge badge-info">Formal Education</span>' : ''}
                                ${t.special_needs_willing ? '<span class="teacher-badge badge-success">Special Needs</span>' : ''}
                                ${comfortLevel && comfortLevel >= 8 ? '<span class="teacher-badge badge-purple">High Comfort w/ Learning Needs</span>' : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ============ DETAIL MODAL ============
        function openTeacherDetail(teacherId) {
            const t = teachers.find(x => x.id === teacherId);
            if (!t) return;

            document.getElementById('modalTeacherName').textContent = `${t.first_name} ${t.last_name}`;

            const strengths = [t.teaching_strength_1, t.teaching_strength_2, t.teaching_strength_3].filter(Boolean);
            const cityList = t.cities.map(c => c.city).join(', ') || 'N/A';
            const languageList = t.languages.map(l => l.language).join(', ') || 'N/A';
            const comfortLevel = t.learning_needs_comfort || 0;

            let html = `
                <div class="detail-section">
                    <div class="detail-section-title">Overview</div>
                    <div class="detail-grid">
                        <div class="detail-item"><label>Brand</label><p>${t.brand || 'N/A'}</p></div>
                        <div class="detail-item"><label>State</label><p>${t.state || 'N/A'}</p></div>
                        <div class="detail-item"><label>Cities</label><p>${cityList}</p></div>
                        <div class="detail-item"><label>Gender</label><p>${t.gender || 'N/A'}</p></div>
                        <div class="detail-item"><label>Languages</label><p>${languageList}</p></div>
                        <div class="detail-item"><label>Year Started</label><p>${t.year_started_at_studio || 'N/A'}</p></div>
                        ${t.zone ? `<div class="detail-item"><label>Zone</label><p>${t.zone.zone_name}</p></div>` : ''}
                    </div>
                </div>
            `;

            // Learning Needs Comfort
            if (comfortLevel > 0) {
                html += `
                    <div class="detail-section">
                        <div class="detail-section-title">Student Learning Needs</div>
                        <div class="comfort-level-display">
                            <div style="flex: 1;">
                                <div class="comfort-level-label">Comfort with diverse learning needs (ADHD, autism, dyslexia, etc.)</div>
                                <div class="comfort-level-bar" style="margin-top: 0.5rem;">
                                    <div class="comfort-level-fill" style="width: ${comfortLevel * 10}%;"></div>
                                </div>
                            </div>
                            <div class="comfort-level-value">${comfortLevel}/10</div>
                        </div>
                        ${t.special_needs_willing ? `<div class="strength-item"><i class="fas fa-check-circle"></i><span>Willing to teach special needs students</span></div>` : ''}
                    </div>
                `;
            } else if (t.special_needs_willing) {
                html += `
                    <div class="detail-section">
                        <div class="detail-section-title">Student Learning Needs</div>
                        <div class="strength-item"><i class="fas fa-check-circle"></i><span>Willing to teach special needs students</span></div>
                    </div>
                `;
            }

            // Education & Strengths
            if (t.formal_music_education || t.formal_education_details || strengths.length > 0) {
                html += `<div class="detail-section"><div class="detail-section-title">Education & Strengths</div>`;
                if (t.formal_education_details) {
                    html += `<div style="margin-bottom: 1rem; font-size: 0.9375rem; color: var(--text-primary); line-height: 1.6;">${t.formal_education_details}</div>`;
                }
                if (strengths.length > 0) {
                    html += strengths.map(s => `<div class="strength-item"><i class="fas fa-check-circle"></i><span>${s}</span></div>`).join('');
                }
                html += `</div>`;
            }

            // Instruments
            if (t.instruments.length > 0) {
                html += `<div class="detail-section"><div class="detail-section-title">Instruments</div>`;
                html += t.instruments.map(i => `
                    <div class="detail-instrument-card">
                        <div class="detail-instrument-name">${i.instrument}</div>
                        <div class="detail-instrument-grid">
                            <div class="detail-item"><label>Highest Teaching Level</label><p>${i.teacher_level || 'N/A'}</p></div>
                            <div class="detail-item"><label>Youngest Age</label><p>${i.youngest_age_preference ? i.youngest_age_preference + '+' : 'N/A'}</p></div>
                            <div class="detail-item"><label>Year Started Teaching</label><p>${i.year_started || 'N/A'}</p></div>
                            <div class="detail-item"><label>Genres</label><p>${i.genres || 'N/A'}</p></div>
                            ${i.achievements_credentials ? `<div class="detail-item" style="grid-column: 1/-1;"><label>Certifications & Experience</label><p>${i.achievements_credentials}</p></div>` : ''}
                            ${i.notes ? `<div class="detail-item" style="grid-column: 1/-1;"><label>Notes</label><div style="font-size: 0.875rem; color: var(--text-secondary); line-height: 1.5;">${i.notes}</div></div>` : ''}
                        </div>
                    </div>
                `).join('');
                html += `</div>`;
            }

            // Additional Notes
            if (t.additional_notes) {
                html += `
                    <div class="detail-section">
                        <div class="detail-section-title">Additional Notes</div>
                        <div style="font-size: 0.9375rem; color: var(--text-primary); line-height: 1.6;">${t.additional_notes}</div>
                    </div>
                `;
            }

            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('teacherModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('teacherModal').classList.remove('active');
        }

        // Close modal on backdrop click
        document.addEventListener('click', (e) => {
            if (e.target.id === 'teacherModal') closeModal();
        });

        // Close modal on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });
    </script>
</body>
</html>
